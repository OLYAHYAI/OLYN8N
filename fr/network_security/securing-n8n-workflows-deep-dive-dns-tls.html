<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sécurisez vos workflows n8n ! Découvrez la configuration approfondie DNS-01 et TLS à l'aide de pfSense, Nginx Proxy Manager et Let's Encrypt pour un accès public ou LAN robuste.">
    <meta name="keywords" content="homelab">
    <meta name="author" content="OLYAHYAI">

    <title>Sécurisation des Workflows N8n : Plongée Profonde DNS TLS | Blog Technique d'Omar LYAHYAI</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Accueil</a></li>
                    <li><a href="/index.html#about" class="nav-link">À propos</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projets</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Compétences</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/en/network_security/securing-n8n-workflows-deep-dive-dns-tls.html" class="lang-toggle" aria-label="Changer de langue">
                        <span class="lang-current">EN</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="Article header">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Breadcrumb">
                        <a href="/index.html">Accueil</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/network_security.html">Sécurité Réseau</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Sécurisation des Workflows N8n : Plongée Profonde DNS TLS</span>
                    </nav>
                </div>

                <h1 class="article-title">Sécurisation des Workflows N8n : Plongée Profonde DNS TLS</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>5 min de lecture</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Sécurité Réseau</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>homelab</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Article content">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1 id="securing-my-n8n-workflows-a-deep-dive-into-dns-and-tls">Sécurisation
de mes Workflows n8n : Plongée Profonde dans DNS et TLS</h1>
<h2 id="objective">Objectif</h2>
<p>Établir un accès **fiable et chiffré** à n8n (et aux services
associés) soit **publiquement** (challenge DNS-01 Let’s Encrypt), soit
**sur le LAN** (Split-DNS + certificat local).</p>
<h2 id="why-secure-n8n">Pourquoi Sécuriser n8n ?</h2>
<p>n8n est une puissante plateforme d'automatisation qui gère souvent des
identifiants sensibles, des clés API et des workflows critiques pour
l'entreprise. Sécuriser l'accès avec un DNS et un TLS appropriés
garantit :</p>
<ul>
<li>**Protection des Données** : Les connexions chiffrées empêchent
l'interception des identifiants.</li>
<li>**Authentification** : Les certificats vérifiés empêchent les
attaques de l'homme du milieu (man-in-the-middle).</li>
<li>**Conformité** : Respecte les meilleures pratiques de sécurité pour
l'automatisation des workflows.</li>
<li>**Configuration Professionnelle** : Démontre la maturité de
l'infrastructure.</li>
</ul>
<h2 id="architecture-overview">Aperçu de l'Architecture</h2>
<pre><code>Internet/LAN Clients
       ↓
   pfSense (DNS + Firewall)
       ↓
Nginx Proxy Manager (TLS Termination)
       ↓
   n8n Docker Container (5678)</code></pre>
<h2
id="option-a-public-domain-cloudflare-dns-challenge-lets-encrypt">Option
A : Domaine Public + Cloudflare + Challenge DNS (Let’s Encrypt)</h2>
<h3 id="prerequisites">Prérequis</h3>
<ul>
<li>Domaine public (peut utiliser des services gratuits comme Freenom)</li>
<li>Compte Cloudflare (le forfait gratuit est suffisant)</li>
<li>Nginx Proxy Manager déployé</li>
<li>n8n exécuté dans Docker</li>
</ul>
<h3 id="step-1-domain-setup-with-cloudflare">Étape 1 : Configuration du
Domaine avec Cloudflare</h3>
<h4 id="register-free-domain-optional">Enregistrer un Domaine Gratuit
(Optionnel)</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visit Freenom.com</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Register domain: my-portfolio.tk (or similar)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Free domains may have limitations</span></span></code></pre></div>
<h4 id="add-domain-to-cloudflare">Ajouter le Domaine à Cloudflare</h4>
<ol type="1">
<li>Créez un compte Cloudflare sur cloudflare.com</li>
<li>Cliquez sur **« Add a site »**</li>
<li>Entrez votre nom de domaine</li>
<li>Choisissez le **plan Gratuit**</li>
<li>Copiez les serveurs de noms Cloudflare (nameservers)</li>
</ol>
<h4 id="update-nameservers-at-registrar">Mettre à Jour les Serveurs de
Noms (Nameservers) chez le Registraire</h4>
<ol type="1">
<li><p>Connectez-vous à votre registraire de domaine (Freenom,
Namecheap, etc.)</p></li>
<li><p>Accédez à **Gestion DNS**</p></li>
<li><p>Remplacez les serveurs de noms existants par ceux de
Cloudflare :</p>
<pre><code>ns1.cloudflare.com
ns2.cloudflare.com</code></pre></li>
<li><p>Attendez la propagation (cela peut prendre jusqu'à 24
heures)</p></li>
</ol>
<h3 id="step-2-generate-cloudflare-api-token">Étape 2 : Générer le
Jeton API Cloudflare</h3>
<ol type="1">
<li>Dans le tableau de bord Cloudflare, cliquez sur l'icône de profil</li>
<li>Naviguez vers **« My Profile »** → **« API Tokens »**</li>
<li>Cliquez sur **« Create Token »**</li>
<li>Utilisez le modèle : **« Edit zone DNS »**</li>
<li>Configurez les permissions :
<ul>
<li>**Zone** : DNS Edit</li>
<li>**Include** : Specific zone (votre domaine)</li>
</ul></li>
<li>Cliquez sur **« Continue to summary »** → **« Create Token »**</li>
<li>**Sauvegardez ce jeton en toute sécurité** – vous ne le verrez
qu'une seule fois !</li>
</ol>
<h3 id="step-3-configure-nginx-proxy-manager">Étape 3 : Configurer Nginx
Proxy Manager</h3>
<h4 id="create-dns-record-in-cloudflare">Créer un Enregistrement DNS
dans Cloudflare</h4>
<ol type="1">
<li>Dans Cloudflare, allez à l'onglet **DNS**</li>
<li>Ajouter un enregistrement A :
<ul>
<li>**Type** : A</li>
<li>**Name** : <code>n8n</code> (ou <code>@</code> pour le domaine
racine)</li>
<li>**IPv4 address** : Votre IP publique ou utilisez le proxy
Cloudflare</li>
<li>**Proxy status** : ✓ Proxied (nuage orange)</li>
</ul></li>
</ol>
<h4 id="add-proxy-host-in-npm">Ajouter un Hôte Proxy dans NPM</h4>
<ol type="1">
<li>Accédez à Nginx Proxy Manager :
<code>http://&lt;npm-ip&gt;:81</code></li>
<li>Cliquez sur **« Proxy Hosts »** → **« Add Proxy Host »**</li>
<li>Onglet **Détails** :
<ul>
<li>**Domain Names** : <code>n8n.my-portfolio.tk</code></li>
<li>**Scheme** : <code>http</code></li>
<li>**Forward Hostname/IP** : <code>n8n</code> (nom du conteneur
Docker) ou IP</li>
<li>**Forward Port** : <code>5678</code></li>
<li>**Support Websockets** : ✓ **CRITIQUE pour n8n**</li>
<li>**Block Common Exploits** : ✓</li>
</ul></li>
<li>Onglet **SSL** :
<ul>
<li><p>Sélectionnez **« Request a new SSL Certificate »**</p></li>
<li><p>Basculez **« Use a DNS Challenge »**</p></li>
<li><p>**Fournisseur DNS** : Sélectionnez
**Cloudflare**</p></li>
<li><p>**Credentials File Content** :</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">dns_cloudflare_api_token </span><span class="ot">=</span><span class="st"> YOUR_CLOUDFLARE_API_TOKEN</span></span></code></pre></div></li>
<li><p>**Adresse E-mail** : Votre e-mail pour Let’s
Encrypt</p></li>
<li><p>Options :</p>
<ul>
<li>✓ Force SSL</li>
<li>✓ Support HTTP/2</li>
<li>✓ HSTS Activé</li>
</ul></li>
</ul></li>
<li>Cliquez sur **Save**</li>
</ol>
<h3 id="step-4-verify-access">Étape 4 : Vérifier l'Accès</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester la résolution DNS</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.my-portfolio.tk</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester l'accès HTTPS</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-I</span> https://n8n.my-portfolio.tk</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Accéder dans le navigateur</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">https://n8n.my-portfolio.tk</span></span></code></pre></div>
<h3 id="advantages-and-limitations">Avantages et Limites</h3>
<p><strong>✅ Avantages :</strong> - Certificat SSL public valide -
Renouvellement automatique tous les 90 jours - Pas besoin d'ouvrir les
ports 80/443 pour la validation HTTP-01 - Fonctionne depuis n'importe où
avec accès à Internet</p>
<p><strong>⚠️ Limites :</strong> - Nécessite un domaine public et la
propagation DNS - Dépend de services externes (Cloudflare, Let’s
Encrypt) - Risques potentiels de confidentialité liés à l'exposition
publique</p>
<h2 id="option-b-local-dns-pfsense-local-certificate">Option B : DNS
Local (pfSense) + Certificat Local</h2>
<h3 id="use-case">Cas d'Utilisation</h3>
<p>Parfait pour : - Accès homelab interne uniquement - Aucun domaine
public désiré - Environnements hors ligne ou isolés (air-gapped) -
Développement et tests</p>
<h3 id="step-1-split-dns-configuration-in-pfsense">Étape 1 :
Configuration du Split-DNS dans pfSense</h3>
<h4 id="configure-dns-resolver-host-overrides">Configurer les Surcharges
d'Hôte (Host Overrides) du Résolveur DNS</h4>
<ol type="1">
<li>Connectez-vous à l'interface web de pfSense</li>
<li>Naviguez vers **Services** → **DNS Resolver**</li>
<li>Assurez-vous que le DNS Resolver est **activé**</li>
<li>Faites défiler jusqu'à **Host Overrides**</li>
<li>Cliquez sur **« Add »** :
<ul>
<li>**Host** : <code>n8n</code></li>
<li>**Domain** : <code>local.home</code> (ou votre choix)</li>
<li>**Adresse IP** : IP de l'hôte exécutant NPM</li>
<li>**Description** : n8n automation platform</li>
</ul></li>
<li>Cliquez sur **Save** → **Appliquer les Changements**</li>
</ol>
<h4 id="test-dns-resolution">Tester la Résolution DNS</h4>
<p>Depuis un client sur votre réseau :</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait résoudre l'IP de votre hôte NPM</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou en utilisant dig</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> n8n.local.home</span></code></pre></div>
<h3 id="step-2-generate-local-ssl-certificate">Étape 2 : Générer un
Certificat SSL Local</h3>
<h4 id="option-a-self-signed-certificate-openssl">Option A : Certificat
Auto-Signé (OpenSSL)</h4>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer la clé privée</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> genrsa <span class="at">-out</span> n8n-local.key 2048</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer la demande de signature de certificat</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> req <span class="at">-new</span> <span class="at">-key</span> n8n-local.key <span class="at">-out</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-subj</span> <span class="st">&quot;/C=US/ST=State/L=City/O=Homelab/CN=n8n.local.home&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer le certificat auto-signé</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> x509 <span class="at">-req</span> <span class="at">-days</span> 365 <span class="at">-in</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">-signkey</span> n8n-local.key <span class="at">-out</span> n8n-local.crt</span></code></pre></div>
<h4 id="option-b-mkcert-recommended">Option B : mkcert (Recommandé)</h4>
<p><strong>Pourquoi mkcert ?</strong> Automatiquement approuvé par les
navigateurs après l'installation de l'AC.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer mkcert</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sur Ubuntu/Debian :</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libnss3-tools</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/FiloSottile/mkcert/releases/download/v1.4.4/mkcert-v1.4.4-linux-amd64</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod +x /usr/local/bin/mkcert</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer l'AC locale</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer le certificat pour n8n</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> n8n.local.home <span class="st">&quot;*.local.home&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci crée :</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1.pem (certificate)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1-key.pem (private key)</span></span></code></pre></div>
<h3 id="step-3-import-certificate-into-npm">Étape 3 : Importer le
Certificat dans NPM</h3>
<ol type="1">
<li>Dans Nginx Proxy Manager, allez à **SSL Certificates**</li>
<li>Cliquez sur **« Add SSL Certificate »** → **« Custom »**</li>
<li>Téléchargez les fichiers :
<ul>
<li>**Certificate Key** :
<code>n8n.local.home+1-key.pem</code></li>
<li>**Certificate** : <code>n8n.local.home+1.pem</code></li>
</ul></li>
<li>Cliquez sur **Save**</li>
</ol>
<h3 id="step-4-create-proxy-host">Étape 4 : Créer l'Hôte Proxy</h3>
<ol type="1">
<li>Cliquez sur **« Proxy Hosts »** → **« Add Proxy Host »**</li>
<li>Onglet **Détails** :
<ul>
<li>**Domain Names** : <code>n8n.local.home</code></li>
<li>**Scheme** : <code>http</code></li>
<li>**Forward Hostname/IP** : <code>n8n</code> ou IP du conteneur</li>
<li>**Forward Port** : <code>5678</code></li>
<li>**Websockets Support** : ✓</li>
<li>**Block Common Exploits** : ✓</li>
</ul></li>
<li>Onglet **SSL** :
<ul>
<li>**Certificat SSL** : Sélectionnez votre certificat
personnalisé</li>
<li>**Force SSL** : ✓</li>
<li>**HTTP/2 Support** : ✓</li>
</ul></li>
<li>Cliquez sur **Save**</li>
</ol>
<h3 id="step-5-install-ca-on-client-devices">Étape 5 : Installer l'AC
sur les Appareils Clients</h3>
<h4 id="for-mkcert">Pour mkcert :</h4>
<p><strong>Linux:</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Windows:</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run mkcert installer</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mkcert-v1<span class="op">.</span><span class="dv">4.4</span><span class="op">-</span>windows-amd64<span class="op">.</span><span class="fu">exe</span> <span class="op">-</span>install</span></code></pre></div>
<p><strong>macOS:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Appareils Mobiles:</strong> - Exportez le certificat d'AC
depuis <code>mkcert -CAROOT</code> - Transférez-le sur l'appareil -
Installez-le comme certificat de confiance</p>
<h3 id="advantages-and-limitations-1">Avantages et Limites</h3>
<p><strong>✅ Avantages :</strong> - Aucune dépendance externe -
Fonctionne hors ligne - Contrôle total sur les certificats - Aucune
exposition publique</p>
<p><strong>⚠️ Limites :</strong> - Nécessite l'installation de l'AC sur
tous les appareils clients - Renouvellement manuel du certificat -
Accessible uniquement sur le réseau local</p>
<h2 id="troubleshooting-common-issues">Dépannage des Problèmes
Courants</h2>
<h3 id="issue-1-n8n-secure-cookie-error">Problème 1 : Erreur de « Secure
Cookie » de n8n</h3>
<p><strong>Problème</strong> : n8n nécessite HTTPS pour les secure
cookies</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser HTTPS (recommandé)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Suivre les étapes ci-dessus</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Désactiver le secure cookie (POUR TEST UNIQUEMENT)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-e</span> N8N_SECURE_COOKIE=false n8nio/n8n</span></code></pre></div>
<h3 id="issue-2-npm-cannot-resolve-container-name">Problème 2 : NPM ne
peut pas Résoudre le Nom du Conteneur</h3>
<p><strong>Problème</strong> : Nginx Proxy Manager ne peut pas atteindre
le conteneur n8n</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser le réseau Docker</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assurez-vous que les deux conteneurs sont sur le même réseau Docker</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Utiliser l'IP de l'hôte au lieu du nom du conteneur</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans l'hôte proxy NPM, utilisez : 192.168.x.x au lieu de &quot;n8n&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3 : Utiliser l'IP du pont Docker</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> inspect n8n <span class="kw">|</span> <span class="fu">grep</span> IPAddress</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisez cette IP dans la configuration NPM</span></span></code></pre></div>
<h3 id="issue-3-internal-dns-not-resolving">Problème 3 : Le DNS
Interne ne se Résout Pas</h3>
<p><strong>Problème</strong> : Les clients ne peuvent pas résoudre
<code>n8n.local.home</code></p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p>**Vérifier que le DNS Resolver de pfSense est en cours
d'exécution** :</p>
<ul>
<li>Services → DNS Resolver → Status</li>
</ul></li>
<li><p>**Vérifier les paramètres DNS du client** :</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linux/macOS</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/resolv.conf</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait afficher l'IP de pfSense</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ipconfig</span> /all</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check DNS Servers</span></span></code></pre></div></li>
<li><p>**Tester depuis pfSense lui-même** :</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostics → Command Prompt</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span></code></pre></div></li>
</ol>
<h3 id="issue-4-lets-encrypt-dns-01-challenge-fails">Problème 4 :
Échec du Challenge DNS-01 Let’s Encrypt</h3>
<p><strong>Problème</strong> : La demande de certificat échoue</p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p>**Vérifier les Permissions du Jeton API** :</p>
<ul>
<li>Doit avoir **Zone:DNS:Edit** pour la zone spécifique</li>
<li>Ne peut pas utiliser la clé API globale</li>
</ul></li>
<li><p>**Vérifier la Propagation de l'Enregistrement TXT** :</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> _acme-challenge.n8n.my-portfolio.tk TXT</span></code></pre></div></li>
<li><p>**Examiner les Logs NPM** :</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs nginx-proxy-manager</span></code></pre></div></li>
</ol>
<h2 id="security-best-practices">Meilleures Pratiques de Sécurité</h2>
<h3 id="enable-authentication-in-n8n">1. Activer l'Authentification
dans n8n</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.yml</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_ACTIVE=true</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_USER=admin</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_PASSWORD=secure_password_here</span></span></code></pre></div>
<h3 id="restrict-access-by-ip">2. Restreindre l'Accès par IP</h3>
<p>Dans NPM, ajoutez une Liste d'Accès : - **Allow** : Vos IP de
confiance - **Deny** : Toutes les autres</p>
<h3 id="use-strong-cloudflare-settings">3. Utiliser des Paramètres
Cloudflare Robustes</h3>
<ul>
<li>Activer **Bot Fight Mode**</li>
<li>Ajouter des **Règles de Page** pour la limitation de débit (rate
limiting)</li>
<li>Activer **Always Use HTTPS**</li>
</ul>
<h3 id="monitor-access-logs">4. Surveiller les Logs d'Accès</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Voir les logs d'accès NPM</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> nginx-proxy-manager tail <span class="at">-f</span> /data/logs/proxy-host-<span class="pp">*</span>.log</span></code></pre></div>
<h3 id="regular-certificate-monitoring">5. Surveillance Régulière des
Certificats</h3>
<ul>
<li>Définir un rappel calendaire pour l'expiration du certificat</li>
<li>Surveiller les logs de renouvellement de NPM</li>
<li>Tester l'accès après les renouvellements</li>
</ul>
<h2 id="validation-checklist">Liste de Validation</h2>
<h3 id="for-public-domain-setup">Pour la Configuration de Domaine
Public :</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Domaine enregistré et
actif</label></li>
<li><label><input type="checkbox" />Serveurs de noms Cloudflare
configurés</label></li>
<li><label><input type="checkbox" />Jeton API créé avec les permissions
correctes</label></li>
<li><label><input type="checkbox" />Enregistrement DNS pointant vers
l'IP publique</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec support
Websocket</label></li>
<li><label><input type="checkbox" />Certificat Let’s Encrypt délivré avec
succès</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
réseau externe</label></li>
<li><label><input type="checkbox" />Les workflows n8n s'exécutent
correctement</label></li>
</ul>
<h3 id="for-local-setup">Pour la Configuration Locale :</h3>
<ul class="task-list">
<li><label><input type="checkbox" />DNS Resolver pfSense
activé</label></li>
<li><label><input type="checkbox" />Host Override configuré pour
<code>n8n.local.home</code></label></li>
<li><label><input type="checkbox" />Certificat local généré (mkcert ou
OpenSSL)</label></li>
<li><label><input type="checkbox" />Certificat importé dans
NPM</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec SSL
personnalisé</label></li>
<li><label><input type="checkbox" />AC installée sur les appareils
clients</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
LAN</label></li>
<li><label><input type="checkbox" />Aucun avertissement de certificat du
navigateur</label></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Sécuriser n8n avec une configuration DNS et TLS appropriée transforme
une plateforme d'automatisation vulnérable en un système prêt pour la
production. Que vous choisissiez l'approche du domaine public avec Let's
Encrypt ou la méthode du certificat local, les deux offrent un chiffrement
robuste et une gestion d'accès professionnelle.</p>
<p>La clé est de comprendre vos besoins : - **Accès public nécessaire
?** → Option A (Cloudflare + Let’s Encrypt) - **Uniquement interne
?** → Option B (pfSense + Certificats Locaux)</p>
<p>Ces deux approches démontrent une maturité d'infrastructure et une
conscience de la sécurité, compétences essentielles pour tout
administrateur de homelab ou professionnel de la sécurité.</p>
<p><em>Rappelez-vous : La sécurité est une question de couches. DNS et
TLS ne sont que le début – ajoutez l'authentification, la surveillance
et des audits réguliers pour une protection complète.</em></p>
                </div>

                <div class="article-navigation">
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>OLYAHYAI</h3>
                    <p>Pentester en Formation | Passionné de Cybersécurité</p>
                </div>

                <div class="footer-links">
                    <h4>Liens Rapides</h4>
                    <ul>
                        <li><a href="/index.html#home">Accueil</a></li>
                        <li><a href="/index.html#about">À propos</a></li>
                        <li><a href="/index.html#projects">Projets</a></li>
                        <li><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-social">
                    <h4>Connexion</h4>
                    <div class="social-links">
                        <a href="https://github.com/OLYAHYAI" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://ma.linkedin.com/in/lyahyai-omar" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="mailto:contact@olyahyai.com">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 OLYAHYAI. Tous droits réservés.</p>
                <p>Construit avec <i class="fas fa-heart"></i> et <i class="fas fa-terminal"></i></p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Retour en haut">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/animations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
---