<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sécurisez les workflows n8n avec le chiffrement DNS et TLS. Guide étape par étape couvrant pfSense, Nginx Proxy Manager (NPM), Cloudflare et la configuration Let's Encrypt DNS-01.">
    <meta name="keywords" content="n8n, TLS, DNS, NginxProxyManager, Let'sEncrypt, pfSense, Security">
    <meta name="author" content="OLYAHYAI">

    <title>Sécurisation des workflows n8n : Plongée approfondie dans DNS et TLS | Blog Technique d'Omar LYAHYAI</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Passer au contenu principal</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Navigation principale">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Basculer la navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Accueil</a></li>
                    <li><a href="/index.html#about" class="nav-link">À propos</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projets</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Compétences</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/en/network_security/securing-n8n-workflows-deep-dive-dns-tls.html" class="lang-toggle" aria-label="Changer de langue">
                        <span class="lang-current">EN</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="Article header">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Breadcrumb">
                        <a href="/index.html">Accueil</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/network_security.html">Sécurité Réseau</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Sécurisation des workflows n8n : Plongée approfondie dans DNS et TLS</span>
                    </nav>
                </div>

                <h1 class="article-title">Sécurisation des workflows n8n : Plongée approfondie dans DNS et TLS</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>5 min de lecture</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Sécurité Réseau</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>n8n, TLS, DNS, NginxProxyManager, Let'sEncrypt, pfSense, Security</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Article content">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1 id="securing-my-n8n-workflows-a-deep-dive-into-dns-and-tls">Sécurisation
de mes workflows n8n : Plongée approfondie dans DNS et TLS</h1>
<h2 id="objective">Objectif</h2>
<p>Établir un accès **fiable et chiffré** à n8n (et
aux services associés) soit **publiquement** (défi Let’s Encrypt
DNS-01) soit **sur le LAN** (Split-DNS + certificat local).</p>
<h2 id="why-secure-n8n">Pourquoi sécuriser n8n ?</h2>
<p>n8n est une puissante plateforme d'automatisation qui gère souvent des
identifiants sensibles, des clés API et des workflows critiques pour
l'entreprise. Sécuriser l'accès avec un DNS et un TLS appropriés
garantit :</p>
<ul>
<li>**Protection des données** : Les connexions chiffrées empêchent
l'interception des identifiants</li>
<li>**Authentification** : Les certificats vérifiés empêchent les
attaques de l'homme du milieu (man-in-the-middle)</li>
<li>**Conformité** : Répond aux meilleures pratiques de sécurité pour
l'automatisation des workflows</li>
<li>**Configuration professionnelle** : Démontre la maturité de
l'infrastructure</li>
</ul>
<h2 id="architecture-overview">Aperçu de l'architecture</h2>
<pre><code>Internet/Clients LAN
       ↓
   pfSense (DNS + Firewall)
       ↓
Nginx Proxy Manager (TLS Termination)
       ↓
   n8n Docker Container (5678)</code></pre>
<h2
id="option-a-public-domain-cloudflare-dns-challenge-lets-encrypt">Option
A : Domaine public + Cloudflare + Défi DNS (Let’s Encrypt)</h2>
<h3 id="prerequisites">Prérequis</h3>
<ul>
<li>Domaine public (peut utiliser des services gratuits comme Freenom)</li>
<li>Compte Cloudflare (le niveau gratuit est suffisant)</li>
<li>Nginx Proxy Manager déployé</li>
<li>n8n fonctionnant dans Docker</li>
</ul>
<h3 id="step-1-domain-setup-with-cloudflare">Étape 1 : Configuration du
domaine avec Cloudflare</h3>
<h4 id="register-free-domain-optional">Enregistrer un domaine gratuit
(Facultatif)</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visit Freenom.com</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Enregistrer le domaine : my-portfolio.tk (ou similaire)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remarque : Les domaines gratuits peuvent avoir des limitations</span></span></code></pre></div>
<h4 id="add-domain-to-cloudflare">Ajouter le domaine à Cloudflare</h4>
<ol type="1">
<li>Créez un compte Cloudflare sur cloudflare.com</li>
<li>Cliquez sur **« Add a site »** (Ajouter un site)</li>
<li>Entrez le nom de votre domaine</li>
<li>Choisissez le **plan Gratuit**</li>
<li>Copiez les serveurs de noms Cloudflare</li>
</ol>
<h4 id="update-nameservers-at-registrar">Mettre à jour les serveurs de
noms chez le registraire</h4>
<ol type="1">
<li><p>Connectez-vous à votre registraire de domaine (Freenom,
Namecheap, etc.)</p></li>
<li><p>Naviguez vers **DNS Management** (Gestion DNS)</p></li>
<li><p>Remplacez les serveurs de noms existants par ceux de Cloudflare
:</p>
<pre><code>ns1.cloudflare.com
ns2.cloudflare.com</code></pre></li>
<li><p>Attendez la propagation (peut prendre jusqu'à 24 heures)</p></li>
</ol>
<h3 id="step-2-generate-cloudflare-api-token">Étape 2 : Générer un jeton
API Cloudflare</h3>
<ol type="1">
<li>Dans le tableau de bord Cloudflare, cliquez sur l'icône de profil</li>
<li>Naviguez vers **« My Profile »** (Mon Profil) → **« API Tokens »**
(Jetons API)</li>
<li>Cliquez sur **« Create Token »** (Créer un jeton)</li>
<li>Utilisez le modèle : **« Edit zone DNS »** (Modifier le DNS de zone)</li>
<li>Configurez les permissions :
<ul>
<li>**Zone** : DNS Edit</li>
<li>**Inclure** : Zone spécifique (votre domaine)</li>
</ul></li>
<li>Cliquez sur **« Continue to summary »** (Continuer vers le résumé)
→ **« Create Token »** (Créer un jeton)</li>
<li>**Enregistrez ce jeton en toute sécurité** - vous ne le verrez
qu'une seule fois !</li>
</ol>
<h3 id="step-3-configure-nginx-proxy-manager">Étape 3 : Configurer Nginx
Proxy Manager</h3>
<h4 id="create-dns-record-in-cloudflare">Créer un enregistrement DNS
dans Cloudflare</h4>
<ol type="1">
<li>Dans Cloudflare, allez à l'onglet **DNS**</li>
<li>Ajouter un enregistrement A :
<ul>
<li>**Type** : A</li>
<li>**Nom** : <code>n8n</code> (ou <code>@</code> pour le domaine
racine)</li>
<li>**Adresse IPv4** : Votre IP publique ou utilisez le proxy
Cloudflare</li>
<li>**Statut du proxy** : ✓ Proxifié (nuage orange)</li>
</ul></li>
</ol>
<h4 id="add-proxy-host-in-npm">Ajouter un hôte proxy dans NPM</h4>
<ol type="1">
<li>Accéder à Nginx Proxy Manager :
<code>http://&lt;npm-ip&gt;:81</code></li>
<li>Cliquez sur **« Proxy Hosts »** (Hôtes Proxy) → **« Add Proxy
Host »** (Ajouter un hôte proxy)</li>
<li>**Onglet Détails** :
<ul>
<li>**Domain Names** : <code>n8n.my-portfolio.tk</code></li>
<li>**Scheme** : <code>http</code></li>
<li>**Nom d'hôte/IP de transfert** : <code>n8n</code> (nom du
conteneur Docker) ou IP</li>
<li>**Forward Port** : <code>5678</code></li>
<li>**Support Websockets** : ✓ **CRITIQUE pour n8n**</li>
<li>**Bloquer les exploits courants** : ✓</li>
</ul></li>
<li>**Onglet SSL** :
<ul>
<li><p>Sélectionnez **« Request a new SSL Certificate »** (Demander un
nouveau certificat SSL)</p></li>
<li><p>Basculez sur **« Use a DNS Challenge »** (Utiliser un défi
DNS)</p></li>
<li><p>**Fournisseur DNS** : Sélectionnez **Cloudflare**</p></li>
<li><p>**Credentials File Content** :</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">dns_cloudflare_api_token </span><span class="ot">=</span><span class="st"> YOUR_CLOUDFLARE_API_TOKEN</span></span></code></pre></div></li>
<li><p>**Adresse e-mail** : Votre e-mail pour Let’s Encrypt</p></li>
<li><p>Options :</p>
<ul>
<li>✓ Forcer SSL</li>
<li>✓ HTTP/2 Support</li>
<li>✓ HSTS Enabled</li>
</ul></li>
</ul></li>
<li>Cliquez sur **Save** (Enregistrer)</li>
</ol>
<h3 id="step-4-verify-access">Étape 4 : Vérifier l'accès</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester la résolution DNS</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.my-portfolio.tk</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester l'accès HTTPS</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-I</span> https://n8n.my-portfolio.tk</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Accéder dans le navigateur</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">https://n8n.my-portfolio.tk</span></span></code></pre></div>
<h3 id="advantages-and-limitations">Avantages et Limitations</h3>
<p><strong>✅ Avantages :</strong> - Certificat SSL public valide -
Renouvellement automatique tous les 90 jours - Pas besoin d'ouvrir les
ports 80/443 pour la validation HTTP-01 - Fonctionne depuis n'importe
où avec accès à Internet</p>
<p><strong>⚠️ Limitations :</strong> - Nécessite un domaine public et
la propagation DNS - Dépend de services externes (Cloudflare, Let’s
Encrypt) - Problèmes potentiels de confidentialité avec l'exposition
publique</p>
<h2 id="option-b-local-dns-pfsense-local-certificate">Option B : DNS
Local (pfSense) + Certificat Local</h2>
<h3 id="use-case">Cas d'utilisation</h3>
<p>Parfait pour : - Accès interne au homelab uniquement - Aucun domaine
public souhaité - Environnements hors ligne ou isolés - Développement et
tests</p>
<h3 id="step-1-split-dns-configuration-in-pfsense">Étape 1 :
Configuration du Split-DNS dans pfSense</h3>
<h4 id="configure-dns-resolver-host-overrides">Configurer les
remplacements d'hôte du résolveur DNS</h4>
<ol type="1">
<li>Connectez-vous à l'interface web pfSense</li>
<li>Naviguez vers **Services** → **DNS Resolver** (Résolveur DNS)</li>
<li>Assurez-vous que le résolveur DNS est **activé**</li>
<li>Faites défiler jusqu'à **Host Overrides** (Remplacements d'hôte)</li>
<li>Cliquez sur **« Add »** (Ajouter) :
<ul>
<li>**Host** : <code>n8n</code></li>
<li>**Domain** : <code>local.home</code> (ou votre choix)</li>
<li>**IP Address** : IP de l'hôte exécutant NPM</li>
<li>**Description** : plateforme d'automatisation n8n</li>
</ul></li>
<li>Cliquez sur **Save** (Enregistrer) → **Apply Changes** (Appliquer les
changements)</li>
</ol>
<h4 id="test-dns-resolution">Tester la résolution DNS</h4>
<p>Depuis un client sur votre réseau :</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait se résoudre à l'IP de votre hôte NPM</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou en utilisant dig</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> n8n.local.home</span></code></pre></div>
<h3 id="step-2-generate-local-ssl-certificate">Étape 2 : Générer un
certificat SSL local</h3>
<h4 id="option-a-self-signed-certificate-openssl">Option A : Certificat
auto-signé (OpenSSL)</h4>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate private key</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> genrsa <span class="at">-out</span> n8n-local.key 2048</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate certificate signing request</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> req <span class="at">-new</span> <span class="at">-key</span> n8n-local.key <span class="at">-out</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-subj</span> <span class="st">&quot;/C=US/ST=State/L=City/O=Homelab/CN=n8n.local.home&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate self-signed certificate</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> x509 <span class="at">-req</span> <span class="at">-days</span> 365 <span class="at">-in</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">-signkey</span> n8n-local.key <span class="at">-out</span> n8n-local.crt</span></code></pre></div>
<h4 id="option-b-mkcert-recommended">Option B : mkcert (Recommandé)</h4>
<p><strong>Pourquoi mkcert ?</strong> Fait automatiquement confiance aux
navigateurs après l'installation de l'AC.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer mkcert</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sur Ubuntu/Debian:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libnss3-tools</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/FiloSottile/mkcert/releases/download/v1.4.4/mkcert-v1.4.4-linux-amd64</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod +x /usr/local/bin/mkcert</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer l'AC locale</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer le certificat pour n8n</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> n8n.local.home <span class="st">&quot;*.local.home&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci crée:</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1.pem (certificat)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1-key.pem (clé privée)</span></span></code></pre></div>
<h3 id="step-3-import-certificate-into-npm">Étape 3 : Importer le
certificat dans NPM</h3>
<ol type="1">
<li>Dans Nginx Proxy Manager, allez à **SSL Certificates** (Certificats
SSL)</li>
<li>Cliquez sur **« Add SSL Certificate »** (Ajouter un certificat SSL)
→ **« Custom »** (Personnalisé)</li>
<li>Télécharger les fichiers :
<ul>
<li>**Certificate Key** :
<code>n8n.local.home+1-key.pem</code></li>
<li>**Certificate** : <code>n8n.local.home+1.pem</code></li>
</ul></li>
<li>Cliquez sur **Save** (Enregistrer)</li>
</ol>
<h3 id="step-4-create-proxy-host">Étape 4 : Créer un hôte proxy</h3>
<ol type="1">
<li>Cliquez sur **« Proxy Hosts »** (Hôtes Proxy) → **« Add Proxy
Host »** (Ajouter un hôte proxy)</li>
<li>**Onglet Détails** :
<ul>
<li>**Domain Names** : <code>n8n.local.home</code></li>
<li>**Scheme** : <code>http</code></li>
<li>**Nom d'hôte/IP de transfert** : <code>n8n</code> ou IP du
conteneur</li>
<li>**Forward Port** : <code>5678</code></li>
<li>**Support Websockets** : ✓</li>
<li>**Bloquer les exploits courants** : ✓</li>
</ul></li>
<li>**Onglet SSL** :
<ul>
<li>**Certificat SSL** : Sélectionnez votre certificat
personnalisé</li>
<li>**Forcer SSL** : ✓</li>
<li>**HTTP/2 Support** : ✓</li>
</ul></li>
<li>Cliquez sur **Save** (Enregistrer)</li>
</ol>
<h3 id="step-5-install-ca-on-client-devices">Étape 5 : Installer l'AC
sur les appareils clients</h3>
<h4 id="for-mkcert">Pour mkcert :</h4>
<p><strong>Linux :</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Windows :</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exécuter l'installateur mkcert</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mkcert-v1<span class="op">.</span><span class="dv">4.4</span><span class="op">-</span>windows-amd64<span class="op">.</span><span class="fu">exe</span> <span class="op">-</span>install</span></code></pre></div>
<p><strong>macOS :</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Appareils mobiles :</strong> - Exporter le certificat AC
depuis <code>mkcert -CAROOT</code> - Transférer vers l'appareil -
Installer comme certificat de confiance</p>
<h3 id="advantages-and-limitations-1">Avantages et Limitations</h3>
<p><strong>✅ Avantages :</strong> - Aucune dépendance externe -
Fonctionne hors ligne - Contrôle total sur les certificats - Aucune
exposition publique</p>
<p><strong>⚠️ Limitations :</strong> - Nécessite l'installation de l'AC
sur tous les appareils clients - Renouvellement manuel du certificat -
Accessible uniquement sur le réseau local</p>
<h2 id="troubleshooting-common-issues">Dépannage des Problèmes
Courants</h2>
<h3 id="issue-1-n8n-secure-cookie-error">Problème 1 : Erreur « Secure
Cookie » de n8n</h3>
<p><strong>Problème</strong> : n8n nécessite HTTPS pour les cookies
sécurisés</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser HTTPS (recommandé)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Suivre les étapes ci-dessus</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Désactiver le cookie sécurisé (POUR </span><span class="al">TESTS</span><span class="co"> UNIQUEMENT)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-e</span> N8N_SECURE_COOKIE=false n8nio/n8n</span></code></pre></div>
<h3 id="issue-2-npm-cannot-resolve-container-name">Problème 2 : NPM ne
peut pas résoudre le nom du conteneur</h3>
<p><strong>Problème</strong> : Nginx Proxy Manager ne peut pas atteindre
le conteneur n8n</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser le réseau Docker</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assurez-vous que les deux conteneurs sont sur le même réseau Docker</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Utiliser l'IP de l'hôte au lieu du nom du conteneur</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans l'hôte proxy NPM, utilisez : 192.168.x.x au lieu de &quot;n8n&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3 : Utiliser l'IP du pont Docker</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> inspect n8n <span class="kw">|</span> <span class="fu">grep</span> IPAddress</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisez cette IP dans la configuration NPM</span></span></code></pre></div>
<h3 id="issue-3-internal-dns-not-resolving">Problème 3 : Le DNS interne
ne se résout pas</h3>
<p><strong>Problème</strong> : Les clients ne peuvent pas résoudre
<code>n8n.local.home</code></p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p><strong>Vérifiez que le résolveur DNS pfSense est en cours
d'exécution</strong> :</p>
<ul>
<li>Services → DNS Resolver (Résolveur DNS) → Status</li>
</ul></li>
<li><p><strong>Vérifiez les paramètres DNS du client</strong> :</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linux/macOS</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/resolv.conf</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait afficher l'IP de pfSense</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ipconfig</span> /all</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier les serveurs DNS</span></span></code></pre></div></li>
<li><p><strong>Tester depuis pfSense lui-même</strong> :</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostics → Command Prompt (Invite de commande)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span></code></pre></div></li>
</ol>
<h3 id="issue-4-lets-encrypt-dns-01-challenge-fails">Problème 4 : Échec
du défi Let’s Encrypt DNS-01</h3>
<p><strong>Problème</strong> : La demande de certificat échoue</p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p><strong>Vérifiez les permissions du jeton API</strong> :</p>
<ul>
<li>Doit avoir **Zone:DNS:Edit** pour la zone spécifique</li>
<li>Ne peut pas utiliser la clé API globale</li>
</ul></li>
<li><p><strong>Vérifiez la propagation de l'enregistrement TXT</strong>
:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> _acme-challenge.n8n.my-portfolio.tk TXT</span></code></pre></div></li>
<li><p><strong>Consultez les journaux NPM</strong> :</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs nginx-proxy-manager</span></code></pre></div></li>
</ol>
<h2 id="security-best-practices">Meilleures pratiques de sécurité</h2>
<h3 id="enable-authentication-in-n8n">1. Activer l'authentification dans
n8n</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.yml</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_ACTIVE=true</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_USER=admin</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_PASSWORD=secure_password_here</span></span></code></pre></div>
<h3 id="restrict-access-by-ip">2. Restreindre l'accès par IP</h3>
<p>Dans NPM, ajoutez une liste d'accès : - **Autoriser** : Vos IPs de
confiance - **Refuser** : Toutes les autres</p>
<h3 id="use-strong-cloudflare-settings">3. Utiliser des paramètres
Cloudflare robustes</h3>
<ul>
<li>Activer le **Mode Anti-Bot** (Bot Fight Mode)</li>
<li>Ajouter des **Règles de Page** (Page Rules) pour la limitation du
débit</li>
<li>Activer **Toujours utiliser HTTPS** (Always Use HTTPS)</li>
</ul>
<h3 id="monitor-access-logs">4. Surveiller les journaux d'accès</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les journaux d'accès NPM</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> nginx-proxy-manager tail <span class="at">-f</span> /data/logs/proxy-host-<span class="pp">*</span>.log</span></code></pre></div>
<h3 id="regular-certificate-monitoring">5. Surveillance régulière des
certificats</h3>
<ul>
<li>Définir un rappel de calendrier pour l'expiration du certificat</li>
<li>Surveiller les journaux de renouvellement NPM</li>
<li>Tester l'accès après les renouvellements</li>
</ul>
<h2 id="validation-checklist">Liste de validation</h2>
<h3 id="for-public-domain-setup">Pour la configuration de domaine public
:</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Domaine enregistré et
actif</label></li>
<li><label><input type="checkbox" />Serveurs de noms Cloudflare
configurés</label></li>
<li><label><input type="checkbox" />Jeton API créé avec les permissions
correctes</label></li>
<li><label><input type="checkbox" />Enregistrement DNS pointant vers
l'IP publique</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec le support
Websocket</label></li>
<li><label><input type="checkbox" />Certificat Let’s Encrypt émis avec
succès</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
réseau externe</label></li>
<li><label><input type="checkbox" />Workflows n8n s'exécutent
correctement</label></li>
</ul>
<h3 id="for-local-setup">Pour la configuration locale :</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Résolveur DNS pfSense
activé</label></li>
<li><label><input type="checkbox" />Remplacement d'hôte configuré pour
<code>n8n.local.home</code></label></li>
<li><label><input type="checkbox" />Certificat local généré (mkcert ou
OpenSSL)</label></li>
<li><label><input type="checkbox" />Certificat importé dans
NPM</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec SSL
personnalisé</label></li>
<li><label><input type="checkbox" />AC installée sur les appareils
clients</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
LAN</label></li>
<li><label><input type="checkbox" />Aucun avertissement de certificat de
navigateur</label></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Sécuriser n8n avec une configuration DNS et TLS appropriée transforme
une plateforme d'automatisation vulnérable en un système prêt pour la
production. Que vous choisissiez l'approche du domaine public avec Let's
Encrypt ou la méthode du certificat local, les deux offrent un chiffrement
solide et une gestion d'accès professionnelle.</p>
<p>La clé est de comprendre vos exigences : - **Accès public
nécessaire ?** → Option A (Cloudflare + Let’s Encrypt) - **Interne
uniquement ?** → Option B (pfSense + Certificats Locaux)</p>
<p>Les deux approches démontrent une maturité de l'infrastructure et une
sensibilisation à la sécurité, des compétences essentielles pour tout
administrateur de homelab ou professionnel de la sécurité.</p>
<p><em>N'oubliez pas : La sécurité est une question de couches. DNS et
TLS ne sont que le début - ajoutez l'authentification, la surveillance et
des audits réguliers pour une protection complète.</em></p>
                </div>

                <div class="article-navigation">
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>OLYAHYAI</h3>
                    <p>Pentester en formation | Passionné de cybersécurité</p>
                </div>

                <div class="footer-links">
                    <h4>Liens Rapides</h4>
                    <ul>
                        <li><a href="/index.html#home">Accueil</a></li>
                        <li><a href="/index.html#about">À propos</a></li>
                        <li><a href="/index.html#projects">Projets</a></li>
                        <li><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-social">
                    <h4>Connecter</h4>
                    <div class="social-links">
                        <a href="https://github.com/OLYAHYAI" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://ma.linkedin.com/in/lyahyai-omar" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="mailto:contact@olyahyai.com">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 OLYAHYAI. Tous droits réservés.</p>
                <p>Construit avec <i class="fas fa-heart"></i> et <i class="fas fa-terminal"></i></p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/animations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
---