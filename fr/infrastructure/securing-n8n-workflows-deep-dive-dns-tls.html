<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sécurisation des workflows N8n : Plongée approfondie dans DNS et TLS - Tutoriel et guide technique">
    <meta name="keywords" content="homelab">
    <meta name="author" content="OLYAHYAI">

    <title>Sécurisation des workflows N8n : Plongée approfondie dans DNS et TLS | Blog Technique d'Omar LYAHYAI</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Passer au contenu principal</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Navigation principale">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Basculer la navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Accueil</a></li>
                    <li><a href="/index.html#about" class="nav-link">À propos</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projets</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Compétences</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/fr/infrastructure/securing-n8n-workflows-deep-dive-dns-tls.html" class="lang-toggle" aria-label="Changer de langue">
                        <span class="lang-current">FR</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="En-tête de l'article">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Fil d'Ariane">
                        <a href="/index.html">Accueil</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/infrastructure.html">Infrastructure</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Sécurisation des workflows N8n : Plongée approfondie dans DNS et TLS</span>
                    </nav>
                </div>

                <h1 class="article-title">Sécurisation des workflows N8n : Plongée approfondie dans DNS et TLS</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>9 min de lecture</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Infrastructure</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>homelab</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Contenu de l'article">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1 id="securing-my-n8n-workflows-a-deep-dive-into-dns-and-tls">Sécuriser
mes workflows N8n : Plongée approfondie dans DNS et TLS</h1>
<h2 id="objective">Objectif</h2>
<p>Établir un accès <strong>fiable et chiffré</strong> à N8n (et aux services associés), soit <strong>publiquement</strong> (challenge Let’s Encrypt DNS-01), soit <strong>sur le réseau local (LAN)</strong> (Split-DNS + certificat local).</p>
<h2 id="why-secure-n8n">Pourquoi sécuriser N8n ?</h2>
<p>N8n est une plateforme d'automatisation puissante qui gère souvent des informations d'identification sensibles, des clés API et des workflows critiques. Sécuriser l'accès avec un DNS et un TLS appropriés garantit :</p>
<ul>
<li><strong>Protection des données</strong> : Les connexions chiffrées empêchent l'interception des identifiants</li>
<li><strong>Authentification</strong> : Les certificats vérifiés empêchent les attaques de l'homme du milieu</li>
<li><strong>Conformité</strong> : Respecte les meilleures pratiques de sécurité pour l'automatisation des workflows</li>
<li><strong>Configuration professionnelle</strong> : Démontre la maturité de l'infrastructure</li>
</ul>
<h2 id="architecture-overview">Aperçu de l'architecture</h2>
<pre><code>Internet/LAN Clients
       ↓
   pfSense (DNS + Firewall)
       ↓
Nginx Proxy Manager (TLS Termination)
       ↓
   n8n Docker Container (5678)</code></pre>
<h2
id="option-a-public-domain-cloudflare-dns-challenge-lets-encrypt">Option
A : Domaine public + Cloudflare + Challenge DNS (Let’s Encrypt)</h2>
<h3 id="prerequisites">Prérequis</h3>
<ul>
<li>Domaine public (possibilité d'utiliser des services gratuits comme Freenom)</li>
<li>Compte Cloudflare (le niveau gratuit est suffisant)</li>
<li>Nginx Proxy Manager déployé</li>
<li>N8n fonctionnant dans Docker</li>
</ul>
<h3 id="step-1-domain-setup-with-cloudflare">Étape 1 : Configuration du domaine avec Cloudflare</h3>
<h4 id="register-free-domain-optional">Enregistrer un domaine gratuit
(Facultatif)</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visit Freenom.com</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Register domain: my-portfolio.tk (or similar)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Free domains may have limitations</span></span></code></pre></div>
<h4 id="add-domain-to-cloudflare">Ajouter le domaine à Cloudflare</h4>
<ol type="1">
<li>Créer un compte Cloudflare sur cloudflare.com</li>
<li>Cliquer sur <strong>« Add a site »</strong></li>
<li>Entrer votre nom de domaine</li>
<li>Choisir le <strong>plan Gratuit</strong></li>
<li>Copier les serveurs de noms Cloudflare</li>
</ol>
<h4 id="update-nameservers-at-registrar">Mettre à jour les serveurs de noms chez le registraire</h4>
<ol type="1">
<li><p>Se connecter à votre registraire de domaine (Freenom, Namecheap,
etc.)</p></li>
<li><p>Naviguer vers <strong>DNS Management</strong> (Gestion DNS)</p></li>
<li><p>Remplacer les serveurs de noms existants par les serveurs de noms Cloudflare :</p>
<pre><code>ns1.cloudflare.com
ns2.cloudflare.com</code></pre></li>
<li><p>Attendre la propagation (peut prendre jusqu'à 24 heures)</p></li>
</ol>
<h3 id="step-2-generate-cloudflare-api-token">Étape 2 : Générer un jeton API Cloudflare</h3>
<ol type="1">
<li>Dans le tableau de bord Cloudflare, cliquer sur l'icône de profil</li>
<li>Naviguer vers <strong>« My Profile »</strong> → <strong>« API
Tokens »</strong></li>
<li>Cliquer sur <strong>« Create Token »</strong> (Créer un jeton)</li>
<li>Utiliser le modèle : <strong>« Edit zone DNS »</strong> (Modifier le DNS de la zone)</li>
<li>Configurer les permissions :
<ul>
<li><strong>Zone</strong> : DNS Edit (Modification DNS)</li>
<li><strong>Inclure</strong> : Zone spécifique (votre domaine)</li>
</ul></li>
<li>Cliquer sur <strong>« Continue to summary »</strong> (Continuer vers le résumé) → <strong>« Create
Token »</strong> (Créer un jeton)</li>
<li><strong>Sauvegardez ce jeton en lieu sûr</strong> - vous ne le verrez qu'une seule
fois !</li>
</ol>
<h3 id="step-3-configure-nginx-proxy-manager">Étape 3 : Configurer Nginx
Proxy Manager</h3>
<h4 id="create-dns-record-in-cloudflare">Créer un enregistrement DNS dans Cloudflare</h4>
<ol type="1">
<li>Dans Cloudflare, aller à l'onglet <strong>DNS</strong></li>
<li>Ajouter un enregistrement A :
<ul>
<li><strong>Type</strong> : A</li>
<li><strong>Nom</strong> : <code>n8n</code> (ou <code>@</code> pour le domaine racine)</li>
<li><strong>Adresse IPv4</strong> : Votre IP publique ou utiliser le proxy Cloudflare</li>
<li><strong>Statut Proxy</strong> : ✓ Proxied (nuage orange)</li>
</ul></li>
</ol>
<h4 id="add-proxy-host-in-npm">Ajouter un hôte proxy dans NPM</h4>
<ol type="1">
<li>Accéder à Nginx Proxy Manager :
<code>http://&lt;npm-ip&gt;:81</code></li>
<li>Cliquer sur <strong>« Proxy Hosts »</strong> → <strong>« Add Proxy
Host »</strong> (Ajouter un hôte proxy)</li>
<li><strong>Onglet Détails</strong> :
<ul>
<li><strong>Noms de domaine</strong> : <code>n8n.my-portfolio.tk</code></li>
<li><strong>Schéma</strong> : <code>http</code></li>
<li><strong>Nom d'hôte/IP de transfert</strong> : <code>n8n</code> (nom du conteneur
Docker) ou IP</li>
<li><strong>Port de transfert</strong> : <code>5678</code></li>
<li><strong>Support Websockets</strong> : ✓ <strong>CRITIQUE pour
N8n</strong></li>
<li><strong>Bloquer les exploits courants</strong> : ✓</li>
</ul></li>
<li><strong>Onglet SSL</strong> :
<ul>
<li><p>Sélectionner <strong>« Request a new SSL Certificate »</strong> (Demander un nouveau certificat SSL)</p></li>
<li><p>Activer <strong>« Use a DNS Challenge »</strong> (Utiliser un challenge DNS)</p></li>
<li><p><strong>Fournisseur DNS</strong> : Sélectionner
<strong>Cloudflare</strong></p></li>
<li><p><strong>Credentials File Content</strong> :</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">dns_cloudflare_api_token </span><span class="ot">=</span><span class="st"> YOUR_CLOUDFLARE_API_TOKEN</span></span></code></pre></div></li>
<li><p><strong>Adresse e-mail</strong> : Votre e-mail pour Let’s
Encrypt</p></li>
<li><p>Options :</p>
<ul>
<li>✓ Forcer SSL</li>
<li>✓ Support HTTP/2</li>
<li>✓ HSTS Activé</li>
</ul></li>
</ul></li>
<li>Cliquer sur <strong>Sauvegarder</strong></li>
</ol>
<h3 id="step-4-verify-access">Étape 4 : Vérifier l'accès</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester la résolution DNS</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.my-portfolio.tk</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester l'accès HTTPS</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-I</span> https://n8n.my-portfolio.tk</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Accéder dans le navigateur</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">https://n8n.my-portfolio.tk</span></span></code></pre></div>
<h3 id="advantages-and-limitations">Avantages et Limites</h3>
<p><strong>✅ Avantages :</strong> - Certificat SSL public valide -
Renouvellement automatique tous les 90 jours - Pas besoin d'ouvrir les ports 80/443 pour
la validation HTTP-01 - Fonctionne de partout avec accès Internet</p>
<p><strong>⚠️ Limites :</strong> - Nécessite un domaine public et la propagation DNS -
Dépend de services externes (Cloudflare, Let’s Encrypt) - Problèmes potentiels de confidentialité dus à l'exposition publique</p>
<h2 id="option-b-local-dns-pfsense-local-certificate">Option B : DNS
Local (pfSense) + Certificat Local</h2>
<h3 id="use-case">Cas d'utilisation</h3>
<p>Parfait pour : - Accès homelab interne uniquement - Aucun domaine public souhaité - Environnements hors ligne ou isolés (air-gapped) - Développement et
test</p>
<h3 id="step-1-split-dns-configuration-in-pfsense">Étape 1 : Configuration Split-DNS dans pfSense</h3>
<h4 id="configure-dns-resolver-host-overrides">Configurer les Host Overrides du Résolveur DNS</h4>
<ol type="1">
<li>Se connecter à l'interface web pfSense</li>
<li>Naviguer vers <strong>Services</strong> → <strong>DNS
Resolver</strong></li>
<li>S'assurer que le Résolveur DNS est <strong>activé</strong></li>
<li>Défiler jusqu'à <strong>Host Overrides</strong></li>
<li>Cliquer sur <strong>« Add »</strong> (Ajouter) :
<ul>
<li><strong>Hôte</strong> : <code>n8n</code></li>
<li><strong>Domaine</strong> : <code>local.home</code> (ou votre
choix)</li>
<li><strong>Adresse IP</strong> : IP de l'hôte exécutant NPM</li>
<li><strong>Description</strong> : Plateforme d'automatisation N8n</li>
</ul></li>
<li>Cliquer sur <strong>Save</strong> (Sauvegarder) → <strong>Apply Changes</strong> (Appliquer les changements)</li>
</ol>
<h4 id="test-dns-resolution">Tester la résolution DNS</h4>
<p>Depuis un client sur votre réseau :</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait résoudre vers l'IP de votre hôte NPM</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou en utilisant dig</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> n8n.local.home</span></code></pre></div>
<h3 id="step-2-generate-local-ssl-certificate">Étape 2 : Générer un certificat SSL local</h3>
<h4 id="option-a-self-signed-certificate-openssl">Option A : Certificat auto-signé (OpenSSL)</h4>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer une clé privée</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> genrsa <span class="at">-out</span> n8n-local.key 2048</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer une demande de signature de certificat</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> req <span class="at">-new</span> <span class="at">-key</span> n8n-local.key <span class="at">-out</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-subj</span> <span class="st">&quot;/C=US/ST=State/L=City/O=Homelab/CN=n8n.local.home&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer un certificat auto-signé</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> x509 <span class="at">-req</span> <span class="at">-days</span> 365 <span class="at">-in</span> n8n-local.csr <span class="dt">\</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">-signkey</span> n8n-local.key <span class="at">-out</span> n8n-local.crt</span></code></pre></div>
<h4 id="option-b-mkcert-recommended">Option B : mkcert (Recommandé)</h4>
<p><strong>Pourquoi mkcert ?</strong> Automatiquement approuvé par les navigateurs après
l'installation de l'autorité de certification (CA).</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer mkcert</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># On Ubuntu/Debian:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libnss3-tools</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/FiloSottile/mkcert/releases/download/v1.4.4/mkcert-v1.4.4-linux-amd64</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv mkcert-v1.4.4-linux-amd64 /usr/local/bin/mkcert</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod +x /usr/local/bin/mkcert</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer l'autorité de certification locale (CA)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Générer le certificat pour n8n</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> n8n.local.home <span class="st">&quot;*.local.home&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci crée :</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1.pem (certificat)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># n8n.local.home+1-key.pem (clé privée)</span></span></code></pre></div>
<h3 id="step-3-import-certificate-into-npm">Étape 3 : Importer le certificat dans NPM</h3>
<ol type="1">
<li>Dans Nginx Proxy Manager, aller à <strong>SSL Certificates</strong></li>
<li>Cliquer sur <strong>« Add SSL Certificate »</strong> →
<strong>« Custom »</strong></li>
<li>Télécharger les fichiers :
<ul>
<li><strong>Clé de certificat</strong> :
<code>n8n.local.home+1-key.pem</code></li>
<li><strong>Certificat</strong> : <code>n8n.local.home+1.pem</code></li>
</ul></li>
<li>Cliquer sur <strong>Sauvegarder</strong></li>
</ol>
<h3 id="step-4-create-proxy-host">Étape 4 : Créer un hôte proxy</h3>
<ol type="1">
<li>Cliquer sur <strong>« Proxy Hosts »</strong> → <strong>« Add Proxy
Host »</strong></li>
<li><strong>Onglet Détails</strong> :
<ul>
<li><strong>Noms de domaine</strong> : <code>n8n.local.home</code></li>
<li><strong>Schéma</strong> : <code>http</code></li>
<li><strong>Nom d'hôte/IP de transfert</strong> : <code>n8n</code> ou IP du conteneur</li>
<li><strong>Port de transfert</strong> : <code>5678</code></li>
<li><strong>Support Websockets</strong> : ✓</li>
<li><strong>Bloquer les exploits courants</strong> : ✓</li>
</ul></li>
<li><strong>Onglet SSL</strong> :
<ul>
<li><strong>Certificat SSL</strong> : Sélectionner votre certificat
personnalisé</li>
<li><strong>Forcer SSL</strong> : ✓</li>
<li><strong>Support HTTP/2</strong> : ✓</li>
</ul></li>
<li>Cliquer sur <strong>Sauvegarder</strong></li>
</ol>
<h3 id="step-5-install-ca-on-client-devices">Étape 5 : Installer l'autorité de certification (CA) sur les appareils clients</h3>
<h4 id="for-mkcert">Pour mkcert :</h4>
<p><strong>Linux :</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Windows :</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exécuter l'installateur mkcert</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mkcert-v1<span class="op">.</span><span class="dv">4.4</span><span class="op">-</span>windows-amd64<span class="op">.</span><span class="fu">exe</span> <span class="op">-</span>install</span></code></pre></div>
<p><strong>macOS :</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mkcert</span> <span class="at">-install</span></span></code></pre></div>
<p><strong>Appareils Mobiles :</strong> - Exporter le certificat CA depuis
<code>mkcert -CAROOT</code> - Transférer vers l'appareil - Installer comme certificat de confiance</p>
<h3 id="advantages-and-limitations-1">Avantages et Limites</h3>
<p><strong>✅ Avantages :</strong> - Aucune dépendance externe - Fonctionne hors ligne - Contrôle total sur les certificats - Aucune exposition publique</p>
<p><strong>⚠️ Limites :</strong> - Nécessite l'installation de l'autorité de certification (CA) sur tous
les appareils clients - Renouvellement manuel des certificats - Accessible uniquement sur le réseau local</p>
<h2 id="troubleshooting-common-issues">Dépannage des problèmes courants</h2>
<h3 id="issue-1-n8n-secure-cookie-error">Problème 1 : Erreur de « Secure Cookie » N8n</h3>
<p><strong>Problème</strong> : N8n exige le protocole HTTPS pour les cookies sécurisés</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser HTTPS (recommandé)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Suivre les étapes ci-dessus</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Désactiver le cookie sécurisé (</span><span class="al">TEST</span><span class="co"> SEULEMENT)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-e</span> N8N_SECURE_COOKIE=false n8nio/n8n</span></code></pre></div>
<h3 id="issue-2-npm-cannot-resolve-container-name">Problème 2 : NPM ne peut pas résoudre le nom du conteneur</h3>
<p><strong>Problème</strong> : Nginx Proxy Manager n'arrive pas à atteindre le conteneur N8n</p>
<p><strong>Solutions</strong> :</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1 : Utiliser le réseau Docker</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># S'assurer que les deux conteneurs sont sur le même réseau Docker</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2 : Utiliser l'IP de l'hôte au lieu du nom du conteneur</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans l'hôte proxy NPM, utiliser : 192.168.x.x au lieu de &quot;n8n&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3 : Utiliser l'IP du bridge Docker</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> inspect n8n <span class="kw">|</span> <span class="fu">grep</span> IPAddress</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Utiliser cette IP dans la configuration NPM</span></span></code></pre></div>
<h3 id="issue-3-internal-dns-not-resolving">Problème 3 : Le DNS interne ne résout pas</h3>
<p><strong>Problème</strong> : Les clients ne peuvent pas résoudre
<code>n8n.local.home</code></p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p><strong>Vérifier que le Résolveur DNS pfSense est en cours d'exécution</strong> :</p>
<ul>
<li>Services → DNS Resolver → Status</li>
</ul></li>
<li><p><strong>Vérifier les paramètres DNS du client</strong> :</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linux/macOS</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/resolv.conf</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Devrait afficher l'IP de pfSense</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ipconfig</span> /all</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier les serveurs DNS</span></span></code></pre></div></li>
<li><p><strong>Tester depuis pfSense lui-même</strong> :</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostics → Command Prompt</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> n8n.local.home</span></code></pre></div></li>
</ol>
<h3 id="issue-4-lets-encrypt-dns-01-challenge-fails">Problème 4 : Le challenge DNS-01 de Let’s Encrypt échoue</h3>
<p><strong>Problème</strong> : La demande de certificat échoue</p>
<p><strong>Solutions</strong> :</p>
<ol type="1">
<li><p><strong>Vérifier les permissions du jeton API</strong> :</p>
<ul>
<li>Doit avoir <strong>Zone:DNS:Edit</strong> pour la zone spécifique</li>
<li>Ne peut pas utiliser la clé API globale</li>
</ul></li>
<li><p><strong>Vérifier la propagation de l'enregistrement TXT</strong> :</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> _acme-challenge.n8n.my-portfolio.tk TXT</span></code></pre></div></li>
<li><p><strong>Examiner les logs NPM</strong> :</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs nginx-proxy-manager</span></code></pre></div></li>
</ol>
<h2 id="security-best-practices">Meilleures pratiques de sécurité</h2>
<h3 id="enable-authentication-in-n8n">1. Activer l'authentification dans
N8n</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.yml</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_ACTIVE=true</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_USER=admin</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> N8N_BASIC_AUTH_PASSWORD=secure_password_here</span></span></code></pre></div>
<h3 id="restrict-access-by-ip">2. Restreindre l'accès par IP</h3>
<p>Dans NPM, ajouter une Liste d'Accès : - <strong>Autoriser</strong> : Vos IP de confiance -
<strong>Refuser</strong> : Toutes les autres</p>
<h3 id="use-strong-cloudflare-settings">3. Utiliser des paramètres Cloudflare robustes</h3>
<ul>
<li>Activer le <strong>Bot Fight Mode</strong></li>
<li>Ajouter des <strong>Règles de Page</strong> pour la limitation de débit</li>
<li>Activer <strong>Always Use HTTPS</strong> (Toujours utiliser HTTPS)</li>
</ul>
<h3 id="monitor-access-logs">4. Surveiller les logs d'accès</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les logs d'accès NPM</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> nginx-proxy-manager tail <span class="at">-f</span> /data/logs/proxy-host-<span class="pp">*</span>.log</span></code></pre></div>
<h3 id="regular-certificate-monitoring">5. Surveillance régulière des certificats</h3>
<ul>
<li>Définir un rappel calendaire pour l'expiration du certificat</li>
<li>Surveiller les logs de renouvellement NPM</li>
<li>Tester l'accès après les renouvellements</li>
</ul>
<h2 id="validation-checklist">Liste de validation</h2>
<h3 id="for-public-domain-setup">Pour la configuration du domaine public :</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Domaine enregistré et
actif</label></li>
<li><label><input type="checkbox" />Serveurs de noms Cloudflare
configurés</label></li>
<li><label><input type="checkbox" />Jeton API créé avec les permissions
correctes</label></li>
<li><label><input type="checkbox" />Enregistrement DNS pointant vers l'IP
publique</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec support
Websocket</label></li>
<li><label><input type="checkbox" />Certificat Let’s Encrypt émis avec
succès</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
réseau externe</label></li>
<li><label><input type="checkbox" />Les workflows N8n s'exécutent
correctement</label></li>
</ul>
<h3 id="for-local-setup">Pour la configuration locale :</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Résolveur DNS pfSense
activé</label></li>
<li><label><input type="checkbox" />Host Override configuré pour
<code>n8n.local.home</code></label></li>
<li><label><input type="checkbox" />Certificat local généré (mkcert
ou OpenSSL)</label></li>
<li><label><input type="checkbox" />Certificat importé dans
NPM</label></li>
<li><label><input type="checkbox" />Hôte proxy NPM créé avec SSL
personnalisé</label></li>
<li><label><input type="checkbox" />CA installée sur les appareils
clients</label></li>
<li><label><input type="checkbox" />Accès HTTPS fonctionnel depuis le
réseau local (LAN)</label></li>
<li><label><input type="checkbox" />Aucun avertissement de certificat du
navigateur</label></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>La sécurisation de N8n avec une configuration DNS et TLS appropriée transforme une plateforme d'automatisation vulnérable en un système prêt pour la production. Que vous choisissiez l'approche par domaine public avec Let’s Encrypt ou la méthode par certificat local, les deux fournissent un chiffrement fort et une gestion d'accès professionnelle.</p>
<p>La clé est de comprendre vos exigences : - <strong>Accès public nécessaire ?</strong> → Option A (Cloudflare + Let’s Encrypt) -
<strong>Uniquement interne ?</strong> → Option B (pfSense + Certificats locaux)</p>
<p>Les deux approches démontrent une maturité d'infrastructure et une conscience de la sécurité, des compétences essentielles pour tout administrateur de homelab ou professionnel de la sécurité.</p>
<p><em>N'oubliez pas : La sécurité est une question de couches. DNS et TLS ne sont qu'un début - ajoutez l'authentification, la surveillance et des audits réguliers pour une protection complète.</em></p>
                </div>

                <div class="article-navigation">
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>OLYAHYAI</h3>
                    <p>Pentester en formation | Passionné de cybersécurité</p>
                </div>

                <div class="footer-links">
                    <h4>Liens rapides</h4>
                    <ul>
                        <li><a href="/index.html#home">Accueil</a></li>
                        <li><a href="/index.html#about">À propos</a></li>
                        <li><a href="/index.html#projects">Projets</a></li>
                        <li><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-social">
                    <h4>Se connecter</h4>
                    <div class="social-links">
                        <a href="https://github.com/OLYAHYAI" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://ma.linkedin.com/in/lyahyai-omar" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="mailto:contact@olyahyai.com">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 OLYAHYAI. Tous droits réservés.</p>
                <p>Construit avec <i class="fas fa-heart"></i> et <i class="fas fa-terminal"></i></p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Retour en haut">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/animations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>