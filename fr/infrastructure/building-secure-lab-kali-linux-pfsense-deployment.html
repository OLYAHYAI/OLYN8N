<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Construction d'un laboratoire sécurisé Déploiement Kali Linux PfSense - Tutoriel et guide technique">
    <meta name="keywords" content="homelab">
    <meta name="author" content="OLYAHYAI">

    <title>Construction d'un laboratoire sécurisé Déploiement Kali Linux PfSense | Blog Technique d'Omar LYAHYAI</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Accueil</a></li>
                    <li><a href="/index.html#about" class="nav-link">À propos</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projets</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Compétences</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/fr/infrastructure/building-secure-lab-kali-linux-pfsense-deployment.html" class="lang-toggle" aria-label="Changer de langue">
                        <span class="lang-current">FR</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="Article header">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Breadcrumb">
                        <a href="/index.html">Accueil</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/infrastructure.html">Infrastructure</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Construction d'un laboratoire sécurisé Déploiement Kali Linux PfSense</span>
                    </nav>
                </div>

                <h1 class="article-title">Construction d'un laboratoire sécurisé Déploiement Kali Linux PfSense</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>5 min de lecture</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Infrastructure</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>homelab</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Article content">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1
id="building-a-secure-lab-kali-linux-and-pfsense-deployment">Construction d'un
laboratoire sécurisé : Déploiement Kali Linux et pfSense</h1>
<h2 id="project-overview">Aperçu du projet</h2>
<p>La création d'un laboratoire de tests d'intrusion et de sécurité dédié est
essentielle pour tout professionnel de la sécurité aspirant. Cet article
documente le déploiement complet d'un environnement homelab sécurisé
comprenant Kali Linux et pfSense fonctionnant sur Proxmox VE.</p>
<h2 id="lab-architecture">Architecture du laboratoire</h2>
<pre><code>Proxmox Host
├── pfSense VM (Firewall/Router)
│   ├── WAN (vmbr0) → 192.168.11.253
│   └── LAN (vmbr1) → 192.168.1.1
├── Kali Linux VM (Penetration Testing)
│   └── Network: vmbr1 → 192.168.1.10
└── Ubuntu Server VM (Services)
    └── Network: vmbr1 → 192.168.1.20</code></pre>
<h2 id="kali-linux-vm-installation">Installation de la VM Kali Linux</h2>
<h3 id="vm-specifications">Spécifications de la VM</h3>
<p><strong>Configuration matérielle :</strong> - <strong>BIOS</strong>:
SeaBIOS (suite à des problèmes de compatibilité OVMF) - <strong>Disque</strong>: 80 Go
(Contrôleur unique VirtIO SCSI) - <strong>CPU</strong>: 4 cœurs -
<strong>RAM</strong>: 8 Go - <strong>Réseau</strong>: VirtIO (connecté
à vmbr1) - <strong>Ordre de démarrage</strong>: Disque d'abord, CD-ROM ensuite</p>
<h3 id="why-these-specs">Pourquoi ces spécifications ?</h3>
<p><strong>Taille du disque (80 Go)</strong>: - Installation de base Kali : ~20 Go
- Base de données d'outils et d'exploits : ~15 Go - Espace de travail et fichiers de projet : ~20
Go - Snapshots de VM et mises à jour : ~25 Go</p>
<p><strong>CPU (4 cœurs)</strong>: - Analyse et exploitation parallèles
- Cassage de mot de passe efficace - Performance fluide de l'interface graphique - Support des outils multithreadés</p>
<p><strong>RAM (8 Go)</strong>: - Fonctionnement confortable de l'interface graphique - Plusieurs VMs pour les scénarios de laboratoire - Développement d'exploits en mémoire - Outils basés sur navigateur (Burp Suite)</p>
<h3 id="creating-the-vm-in-proxmox">Création de la VM dans Proxmox</h3>
<h4 id="step-1-download-kali-linux-iso">Étape 1 : Télécharger l'ISO de Kali Linux</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sur l'hôte Proxmox</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /var/lib/vz/template/iso</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Télécharger la dernière version de Kali Linux</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://cdimage.kali.org/kali-2024.4/kali-linux-2024.4-installer-amd64.iso</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier la somme de contrôle</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://cdimage.kali.org/kali-2024.4/SHA256SUMS</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sha256sum</span> <span class="at">-c</span> SHA256SUMS <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="kw">|</span> <span class="fu">grep</span> kali-linux-2024.4-installer-amd64.iso</span></code></pre></div>
<h4 id="step-2-create-vm-via-proxmox-ui">Étape 2 : Créer la VM via l'interface utilisateur de Proxmox</h4>
<ol type="1">
<li><strong>Général</strong>:
<ul>
<li>VM ID: 101 (ou votre préférence)</li>
<li>Nom: kali-pentest</li>
<li>Démarrer au boot: Non (démarrage manuel pour le travail en lab)</li>
</ul></li>
<li><strong>OS</strong>:
<ul>
<li>Image ISO: kali-linux-2024.4-installer-amd64.iso</li>
<li>Type d'OS invité: Linux</li>
<li>Version: 6.x - 2.6 Kernel</li>
</ul></li>
<li><strong>Système</strong>:
<ul>
<li>BIOS: SeaBIOS</li>
<li>Machine: i440fx (ou q35 pour un meilleur support matériel)</li>
<li>Contrôleur SCSI: VirtIO SCSI Simple</li>
<li>Agent Qemu: ✓ (activer après l'installation de l'OS)</li>
</ul></li>
<li><strong>Disques</strong>:
<ul>
<li>Bus/Périphérique: SCSI</li>
<li>Stockage: local-lvm</li>
<li>Taille du disque: 80 Go</li>
<li>Cache: Write back (pour de meilleures performances)</li>
<li>Discard: ✓ (pour le thin provisioning)</li>
<li>Émulation SSD: ✓ (si l'hôte utilise un SSD)</li>
</ul></li>
<li><strong>CPU</strong>:
<ul>
<li>Sockets: 1</li>
<li>Cœurs: 4</li>
<li>Type: host (ou kvm64 pour la compatibilité)</li>
</ul></li>
<li><strong>Mémoire</strong>:
<ul>
<li>Mémoire: 8192 Mo</li>
<li>Minimum: 4096 Mo (ballooning)</li>
</ul></li>
<li><strong>Réseau</strong>:
<ul>
<li>Pont: vmbr1 (réseau de laboratoire isolé)</li>
<li>Modèle: VirtIO (paravirtualisé)</li>
<li>Pare-feu: Désactivé (pfSense s'en chargera)</li>
</ul></li>
</ol>
<h4 id="step-3-install-kali-linux">Étape 3 : Installer Kali Linux</h4>
<ol type="1">
<li>Démarrer la VM et ouvrir la console</li>
<li>Démarrer à partir de l'installateur</li>
<li>Sélectionner <strong>Installation Graphique</strong></li>
<li>Langue, Emplacement, Clavier: Vos préférences</li>
<li>Configuration réseau:
<ul>
<li>Configurer automatiquement via DHCP (pfSense fournira)</li>
<li>Hostname: kali-pentest</li>
<li>Domaine: lab.local</li>
</ul></li>
<li>Configuration de l'utilisateur:
<ul>
<li>Nom complet: Testeur d'intrusion</li>
<li>Nom d'utilisateur: pentest</li>
<li>Mot de passe: <strong>Mot de passe fort requis</strong></li>
</ul></li>
<li>Partitionnement:
<ul>
<li>Méthode: Guidé - utiliser tout le disque</li>
<li>Schéma: Tous les fichiers dans une seule partition</li>
<li>Écrire les changements: Oui</li>
</ul></li>
<li>Sélection de logiciels:
<ul>
<li>✓ Bureau Kali par défaut (XFCE recommandé pour les performances)</li>
<li>✓ Les 10 meilleurs outils de sécurité</li>
<li>✓ Grande collection d'outils (si l'espace disque le permet)</li>
</ul></li>
<li>Chargeur de démarrage GRUB:
<ul>
<li>Installer sur: /dev/sda</li>
<li>Continuer</li>
</ul></li>
<li>Redémarrer et se connecter</li>
</ol>
<h3 id="post-installation-configuration">Configuration post-installation</h3>
<h4 id="update-system">Mettre à jour le système</h4>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise à jour complète du système</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt full-upgrade <span class="at">-y</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre à jour la liste des paquets Kali</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer des outils supplémentaires</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    vim <span class="dt">\</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    git <span class="dt">\</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    curl <span class="dt">\</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    wget <span class="dt">\</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    tmux <span class="dt">\</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    net-tools <span class="dt">\</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    nmap <span class="dt">\</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    wireshark <span class="dt">\</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    metasploit-framework</span></code></pre></div>
<h4 id="install-proxmox-guest-agent">Installer l'Agent Invité Proxmox</h4>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer qemu-guest-agent</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install qemu-guest-agent <span class="at">-y</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Activer et démarrer le service</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable qemu-guest-agent</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start qemu-guest-agent</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans l'interface utilisateur Proxmox: VM → Options → QEMU Guest Agent → Activer</span></span></code></pre></div>
<h2 id="pfsense-vm-installation">Installation de la VM pfSense</h2>
<h3 id="vm-specifications-1">Spécifications de la VM</h3>
<p><strong>Configuration matérielle :</strong> - <strong>BIOS</strong>:
SeaBIOS - <strong>Disque</strong>: 20 Go (suffisant pour pfSense +
paquets) - <strong>CPU</strong>: 2 cœurs (suffisant pour un petit laboratoire) -
<strong>RAM</strong>: 4 Go (2 Go minimum, 4 Go confortables) -
<strong>Interfaces réseau</strong>: - vtnet0 (WAN) → vmbr0 - vtnet1
(LAN) → vmbr1</p>
<h3 id="creating-virtual-bridge-vmbr1">Création du Pont Virtuel
(vmbr1)</h3>
<p>Avant de créer la VM pfSense, assurez-vous que vmbr1 existe :</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sur l'hôte Proxmox, éditer la configuration réseau</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> /etc/network/interfaces</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter la configuration vmbr1 :</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">auto</span> vmbr1</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">iface</span> vmbr1 inet manual</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-ports</span> none</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-stp</span> off</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-fd</span> 0</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-vlan-aware</span> yes</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-vids</span> 2-4094</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pas d'adresse IP - c'est uniquement pour les VMs</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer les changements</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">ifreload</span> <span class="at">-a</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> link show vmbr1</span></code></pre></div>
<h3 id="creating-pfsense-vm">Création de la VM pfSense</h3>
<h4 id="download-pfsense-iso">Télécharger l'ISO de pfSense</h4>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sur l'hôte Proxmox</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /var/lib/vz/template/iso</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Télécharger pfSense (édition communautaire)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://nyifiles.netgate.com/mirror/downloads/pfSense-CE-2.7.2-RELEASE-amd64.iso.gz</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gunzip</span> pfSense-CE-2.7.2-RELEASE-amd64.iso.gz</span></code></pre></div>
<h4 id="create-vm-via-proxmox-ui">Créer la VM via l'interface utilisateur de Proxmox</h4>
<ol type="1">
<li><strong>Général</strong>:
<ul>
<li>VM ID: 100</li>
<li>Nom: pfsense-firewall</li>
<li>Démarrer au boot: Oui (infrastructure critique)</li>
</ul></li>
<li><strong>OS</strong>:
<ul>
<li>Image ISO: pfSense-CE-2.7.2-RELEASE-amd64.iso</li>
<li>Type d'OS invité: Autre</li>
</ul></li>
<li><strong>Système</strong>:
<ul>
<li>BIOS: SeaBIOS</li>
<li>Contrôleur SCSI: VirtIO SCSI</li>
</ul></li>
<li><strong>Disques</strong>:
<ul>
<li>Bus/Périphérique: SCSI</li>
<li>Taille du disque: 20 Go</li>
<li>Cache: Write back</li>
</ul></li>
<li><strong>CPU</strong>:
<ul>
<li>Cœurs: 2</li>
</ul></li>
<li><strong>Mémoire</strong>:
<ul>
<li>Mémoire: 4096 Mo</li>
</ul></li>
<li><strong>Réseau</strong>:
<ul>
<li><strong>Première Interface</strong> (WAN):
<ul>
<li>Pont: vmbr0</li>
<li>Modèle: VirtIO</li>
</ul></li>
<li>Après la création, <strong>ajouter la seconde interface</strong> (LAN):
<ul>
<li>Matériel → Ajouter → Périphérique Réseau</li>
<li>Pont: vmbr1</li>
<li>Modèle: VirtIO</li>
</ul></li>
</ul></li>
</ol>
<h4 id="install-pfsense">Installer pfSense</h4>
<ol type="1">
<li>Démarrer la VM et ouvrir la console</li>
<li>Accepter l'avis de droit d'auteur</li>
<li>Installer pfSense : Sélectionner <strong>Install</strong></li>
<li>Mappage clavier: Auto (ZFS)</li>
<li>Partitionnement: <strong>Stripe</strong> (disque unique)</li>
<li>Sélectionner le disque: <code>da0</code> (20Go)</li>
<li>Confirmer: Oui</li>
<li>L'installation est terminée</li>
<li>Redémarrer</li>
</ol>
<h4 id="initial-pfsense-configuration">Configuration initiale de pfSense</h4>
<p>Après le redémarrage, configurer les interfaces via la console :</p>
<pre><code>Should VLANs be set up now? n

Enter the WAN interface name: vtnet0
Enter the LAN interface name: vtnet1

Proceed? y</code></pre>
<p>Définir l'adresse IP du LAN :</p>
<pre><code>Set interface(s) IP address
Select interface: 2 (LAN)

Configure IPv4 address via DHCP? n
Enter new LAN IPv4 address: 192.168.1.1
Enter new LAN IPv4 subnet: 24

Configure IPv6? n

Enable DHCP server on LAN? y
Enter start IP: 192.168.1.10
Enter end IP: 192.168.1.250</code></pre>
<h4 id="access-pfsense-web-interface">Accéder à l'interface Web de pfSense</h4>
<p>Depuis la VM Kali ou une autre VM sur vmbr1 :</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir un bail DHCP de pfSense</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dhclient</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier l'IP</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> addr show</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Accéder à l'interface graphique de pfSense</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">https://192.168.1.1</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants par défaut :</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Username: admin</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Password: pfsense</span></span></code></pre></div>
<h2 id="lab-network-configuration">Configuration du réseau du laboratoire</h2>
<h3 id="network-diagram">Diagramme du réseau</h3>
<pre><code>Internet
   ↓
Router (192.168.11.1)
   ↓
Proxmox vmbr0 (192.168.11.254)
   ↓
pfSense WAN (192.168.11.253)
   ↓
pfSense LAN (192.168.1.1)
   ↓
vmbr1 (Réseau interne du Lab)
   ├── Kali Linux (192.168.1.10)
   ├── Ubuntu Server (192.168.1.20)
   └── Target VMs (192.168.1.50-100)</code></pre>
<h3 id="configure-kali-network">Configurer le réseau Kali</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifier la configuration réseau</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/network/interfaces</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter une IP statique (facultatif, DHCP fonctionne aussi)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">auto</span> eth0</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">iface</span> eth0 inet static</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">address</span> 192.168.1.10</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">netmask</span> 255.255.255.0</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gateway</span> 192.168.1.1</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">dns-nameservers</span> 192.168.1.1</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Redémarrer la mise en réseau</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart networking</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou utiliser le gestionnaire de réseau</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nmtui</span></code></pre></div>
<h2 id="taking-snapshots">Prise de Snapshots</h2>
<h3 id="why-snapshot">Pourquoi un Snapshot ?</h3>
<ul>
<li><strong>Expérimentation sûre</strong>: Revenir en arrière après les tests</li>
<li><strong>Sauvegardes de configuration</strong>: Avant les changements majeurs</li>
<li><strong>Récupération rapide</strong>: Retour arrière suite à des défaillances</li>
</ul>
<h3 id="create-snapshot-via-proxmox-ui">Créer un Snapshot via l'interface utilisateur de Proxmox</h3>
<ol type="1">
<li>Sélectionner la VM (Kali ou pfSense)</li>
<li>Aller à l'onglet <strong>Snapshots</strong></li>
<li>Cliquer sur <strong>Take Snapshot</strong> (Prendre un Snapshot)</li>
<li>Nom: <code>post-install-clean</code> ou
<code>working-config</code></li>
<li>Description: « Installation fraîche, entièrement mise à jour »</li>
<li>Inclure la RAM: Non (snapshot plus petit)</li>
</ol>
<h3 id="create-snapshot-via-cli">Créer un Snapshot via la CLI</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Snapshot de la VM Kali (ID 101)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">qm</span> snapshot 101 post-install <span class="at">--description</span> <span class="st">&quot;Clean Kali install after updates&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Snapshot de la VM pfSense (ID 100)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">qm</span> snapshot 100 baseline-config <span class="at">--description</span> <span class="st">&quot;Working pfSense configuration&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Lister les snapshots</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">qm</span> listsnapshot 101</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Revenir au snapshot</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">qm</span> rollback 101 post-install</span>