<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Débloquer l'accès à distance Cloudflare Tunnel et Proxmox - Tutoriel et guide technique">
    <meta name="keywords" content="homelab">
    <meta name="author" content="OLYAHYAI">

    <title>Débloquer l'accès à distance Cloudflare Tunnel et Proxmox | Blog Technique d'Omar LYAHYAI</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Passer au contenu principal</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Navigation principale">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Basculer la navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Accueil</a></li>
                    <li><a href="/index.html#about" class="nav-link">À propos</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projets</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Compétences</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/fr/infrastructure/unlocking-remote-access-cloudflare-tunnel-proxmox.html" class="lang-toggle" aria-label="Changer de langue">
                        <span class="lang-current">FR</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="En-tête de l'article">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Fil d'Ariane">
                        <a href="/index.html">Accueil</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/infrastructure.html">Infrastructure</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Débloquer l'accès à distance Cloudflare Tunnel et Proxmox</span>
                    </nav>
                </div>

                <h1 class="article-title">Débloquer l'accès à distance Cloudflare Tunnel et Proxmox</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>Lecture de 8 min</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Infrastructure</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>homelab</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Contenu de l'article">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1
id="unlocking-remote-access-my-journey-with-cloudflare-tunnel-and-proxmox">Débloquer
l'accès à distance : Mon expérience avec Cloudflare Tunnel et Proxmox</h1>
<h2 id="project-goal">Objectif du projet</h2>
<p>Établir un accès à distance sécurisé à l'interface web de Proxmox VE via un
sous-domaine public (<code>proxmox.olyhome.site</code>) en utilisant Cloudflare Tunnel,
éliminant ainsi la nécessité d'exposer des ports directement à Internet.</p>
<h2 id="why-cloudflare-tunnel">Pourquoi Cloudflare Tunnel ?</h2>
<h3 id="traditional-remote-access-problems">Problèmes d'accès à distance traditionnels</h3>
<p><strong>Approche par redirection de ports (Port Forwarding):</strong> - ❌ Expose les services
directement à Internet - ❌ Nécessite une IP statique ou un DNS dynamique - ❌
Vulnérable aux attaques de balayage de ports - ❌ Gestion complexe du pare-feu</p>
<p><strong>Avantages de Cloudflare Tunnel :</strong> - ✅ Aucun port exposé
sur le pare-feu - ✅ Protection DDoS intégrée - ✅ Certificats SSL gratuits -
✅ Fonctionne avec des IP dynamiques - ✅ Contrôle d'accès via Cloudflare Zero
Trust</p>
<h2 id="infrastructure-overview">Aperçu de l'infrastructure</h2>
<pre><code>Internet Users
    ↓
Cloudflare Edge Network
    ↓
Cloudflare Tunnel (cloudflared)
    ↓
Proxmox Host (192.168.11.254:8006)</code></pre>
<h2 id="setup-process">Processus de configuration</h2>
<h3 id="step-1-prerequisites">Étape 1 : Prérequis</h3>
<p><strong>Exigences :</strong> - Nom de domaine (ex. : olyhome.site) -
Compte Cloudflare (le niveau gratuit est suffisant) - Proxmox VE installé et
accessible sur le LAN - Système Linux pour exécuter cloudflared</p>
<h3 id="step-2-configure-domain-in-cloudflare">Étape 2 : Configurer le domaine
dans Cloudflare</h3>
<ol type="1">
<li><strong>Ajouter le site à Cloudflare :</strong>
<ul>
<li>Connectez-vous au tableau de bord Cloudflare</li>
<li>Cliquez sur « Add a Site » (Ajouter un site)</li>
<li>Entrez le domaine : <code>olyhome.site</code></li>
<li>Choisissez le plan Gratuit</li>
</ul></li>
<li><strong>Mettre à jour les serveurs de noms (Nameservers) :</strong>
<ul>
<li>Copiez les serveurs de noms Cloudflare</li>
<li>Mettez-les à jour auprès du registraire de domaine (Hostinger, Namecheap, etc.)</li>
<li>Attendez la propagation (jusqu'à 24 heures)</li>
</ul></li>
</ol>
<h3 id="step-3-create-cloudflare-tunnel">Étape 3 : Créer le Cloudflare
Tunnel</h3>
<p><strong>Via le tableau de bord Cloudflare :</strong></p>
<ol type="1">
<li>Naviguez vers <strong>Zero Trust</strong> → <strong>Access</strong> →
<strong>Tunnels</strong></li>
<li>Cliquez sur <strong>« Create a tunnel »</strong> (Créer un tunnel)</li>
<li>Sélectionnez <strong>Cloudflared</strong></li>
<li>Nom du tunnel : <code>proxmox-tunnel</code></li>
<li>Cliquez sur <strong>Save tunnel</strong> (Enregistrer le tunnel)</li>
</ol>
<p><strong>Copiez le jeton du tunnel</strong> – nécessaire pour
l'installation de cloudflared.</p>
<h3 id="step-4-install-cloudflared-on-proxmox-host">Étape 4 : Installer
cloudflared sur l'hôte Proxmox</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download cloudflared</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dpkg <span class="at">-i</span> cloudflared-linux-amd64.deb</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify installation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">cloudflared</span> <span class="at">--version</span></span></code></pre></div>
<h3 id="step-5-configure-tunnel">Étape 5 : Configurer le tunnel</h3>
<p><strong>Créer un fichier de configuration :</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create config directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/cloudflared</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create config file</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/cloudflared/config.yml</span></code></pre></div>
<p><strong>Configuration (<code>config.yml</code>) :</strong></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tunnel</span><span class="kw">:</span><span class="at"> &lt;TUNNEL_ID&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">credentials-file</span><span class="kw">:</span><span class="at"> /etc/cloudflared/&lt;TUNNEL_ID&gt;.json</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ingress</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">hostname</span><span class="kw">:</span><span class="at"> proxmox.olyhome.site</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">service</span><span class="kw">:</span><span class="at"> https://localhost:8006</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">originRequest</span><span class="kw">:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">noTLSVerify</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">  # Required for self-signed Proxmox cert</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">service</span><span class="kw">:</span><span class="at"> http_status:404</span></span></code></pre></div>
<p><strong>Enregistrer les identifiants du tunnel :</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create credentials file from Cloudflare dashboard</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/cloudflared/<span class="op">&lt;</span>TUNNEL_ID<span class="op">&gt;</span>.json</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Paste JSON credentials from Cloudflare</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set proper permissions</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod 600 /etc/cloudflared/<span class="op">&lt;</span>TUNNEL_ID<span class="op">&gt;</span>.json</span></code></pre></div>
<h3 id="step-6-configure-public-hostname-in-cloudflare">Étape 6 :
Configurer le nom d'hôte public dans Cloudflare</h3>
<ol type="1">
<li>Dans le tableau de bord Cloudflare, accédez à la configuration du tunnel</li>
<li>Cliquez sur l'onglet <strong>Public Hostnames</strong> (Noms d'hôtes publics)</li>
<li>Cliquez sur <strong>Add a public hostname</strong> (Ajouter un nom d'hôte public) :
<ul>
<li><strong>Subdomain</strong> (Sous-domaine) : <code>proxmox</code></li>
<li><strong>Domain</strong> (Domaine) : <code>olyhome.site</code></li>
<li><strong>Service</strong> : <code>https://localhost:8006</code></li>
</ul></li>
<li>Cliquez sur <strong>Save</strong> (Enregistrer)</li>
</ol>
<h3 id="step-7-start-cloudflare-tunnel">Étape 7 : Démarrer le Cloudflare
Tunnel</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test configuration</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cloudflared tunnel <span class="at">--config</span> /etc/cloudflared/config.yml run</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If successful, install as service</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cloudflared service install</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable auto-start</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable cloudflared</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Start service</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start cloudflared</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check status</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status cloudflared</span></code></pre></div>
<h3 id="step-8-configure-ssl-for-proxmox-optional">Étape 8 : Configurer SSL
pour Proxmox (Facultatif)</h3>
<p><strong>Pour un SSL approprié sans avertissements, obtenez un certificat Let’s Encrypt
:</strong></p>
<ol type="1">
<li><strong>Dans l'interface utilisateur Proxmox :</strong>
<ul>
<li>Naviguez vers <strong>Datacenter</strong> → <strong>ACME</strong></li>
<li>Ajouter un compte : Let’s Encrypt</li>
<li>Ajouter le plugin DNS Challenge (Cloudflare)</li>
</ul></li>
<li><strong>Ajouter le jeton d'API Cloudflare :</strong>
<ul>
<li>Le jeton nécessite la permission Zone:DNS:Edit</li>
<li>Ajouter à la configuration ACME de Proxmox</li>
</ul></li>
<li><strong>Demander un certificat :</strong>
<ul>
<li>Node → System → Certificates (Certificats)</li>
<li>Ajouter : ACME</li>
<li>Domaine : <code>proxmox.olyhome.site</code></li>
<li>Challenge : DNS</li>
<li>Commander le certificat</li>
</ul></li>
</ol>
<h2 id="issues-encountered-and-solutions">Problèmes rencontrés et
solutions</h2>
<h3 id="issue-1-tunnel-shows-down-status">Problème 1 : Le tunnel indique le statut “DOWN”
(Hors service)</h3>
<p><strong>Problème :</strong> Le tableau de bord Cloudflare affiche le statut du tunnel comme
DOWN avec l'Erreur 1033.</p>
<p><strong>Cause :</strong> Le tunnel n'est pas correctement connecté à la périphérie (edge) Cloudflare.</p>
<p><strong>Solution :</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cloudflared service status</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status cloudflared</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View logs</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> journalctl <span class="at">-u</span> cloudflared <span class="at">-f</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart service</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart cloudflared</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify tunnel ID matches config</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">cloudflared</span> tunnel list</span></code></pre></div>
<h3 id="issue-2-502-bad-gateway-error">Problème 2 : Erreur 502 Bad Gateway
</h3>
<p><strong>Problème :</strong> L'accès à
<code>https://proxmox.olyhome.site</code> renvoie une erreur 502.</p>
<p><strong>Causes :</strong> 1. Le service Proxmox n'est pas en cours d'exécution 2. URL
de service incorrecte dans la configuration 3. Problèmes de vérification TLS</p>
<p><strong>Solutions :</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Verify Proxmox is running</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">systemctl</span> status pveproxy</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Test local access</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-k</span> https://localhost:8006</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Update config.yml with noTLSVerify</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">originRequest:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">noTLSVerify:</span> true</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Restart cloudflared</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart cloudflared</span></code></pre></div>
<h3 id="issue-3-network-connectivity-lost-after-reboot">Problème 3 :
Perte de connectivité réseau après le redémarrage</h3>
<p><strong>Problème :</strong> Proxmox perd la connectivité réseau après le redémarrage du
système, le ping échoue.</p>
<p><strong>Cause :</strong> La passerelle (gateway) n'est pas appliquée correctement à partir de
<code>/etc/network/interfaces</code>.</p>
<p><strong>Solution :</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually add default route</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> route add default via 192.168.11.1 dev vmbr0</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify connectivity</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> 8.8.8.8</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># To make permanent, ensure /etc/network/interfaces contains:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">auto</span> vmbr0</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">iface</span> vmbr0 inet static</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">address</span> 192.168.11.254/24</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gateway</span> 192.168.11.1</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-ports</span> enp3s0</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-stp</span> off</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bridge-fd</span> 0</span></code></pre></div>
<h3 id="issue-4-cloudflared-not-starting-automatically">Problème 4 :
cloudflared ne démarre pas automatiquement</h3>
<p><strong>Problème :</strong> Le tunnel fonctionne lorsqu'il est exécuté manuellement mais
ne démarre pas au démarrage du système.</p>
<p><strong>Cause :</strong> Le service a été lancé avec <code>--token</code> au lieu de
<code>--config</code>.</p>
<p><strong>Solution :</strong></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uninstall existing service</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cloudflared service uninstall</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reinstall with proper config</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cloudflared service install</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure systemd service uses config file</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/systemd/system/cloudflared.service</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify ExecStart line:</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="va">ExecStart</span><span class="op">=</span>/usr/bin/cloudflared <span class="ex">--config</span> /etc/cloudflared/config.yml tunnel run</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload systemd and restart</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl daemon-reload</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable cloudflared</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart cloudflared</span></code></pre></div>
<h3 id="issue-5-tls-strict-mode-blocking-access">Problème 5 : Le mode strict
TLS bloque l'accès</h3>
<p><strong>Problème :</strong> Le mode SSL/TLS de Cloudflare est défini sur « Full
(Strict) » et bloque l'accès en raison d'un certificat auto-signé.</p>
<p><strong>Solution :</strong></p>
<p><strong>Option A : Modifier le mode SSL Cloudflare (Correction rapide) :</strong> 1.
Tableau de bord Cloudflare → SSL/TLS 2. Changez le mode de <strong>Full
(Strict)</strong> à <strong>Full</strong> 3. Cela autorise les certificats auto-signés</p>
<p><strong>Option B : Installer un certificat valide (Correction appropriée) :</strong> 1.
Utilisez Proxmox ACME avec le challenge DNS Cloudflare 2. Obtenez un
certificat Let’s Encrypt 3. Conservez le mode <strong>Full (Strict)</strong> pour une meilleure
sécurité</p>
<h2 id="verification-and-testing">Vérification et tests</h2>
<h3 id="test-external-access">Tester l'accès externe</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From external network (mobile data, different ISP)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-I</span> https://proxmox.olyhome.site</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected: 200 OK response</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Access in browser</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">https://proxmox.olyhome.site</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Should show Proxmox login page</span></span></code></pre></div>
<h3 id="verify-tunnel-health">Vérifier l'état du tunnel</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check tunnel status</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cloudflared</span> tunnel info <span class="op">&lt;</span>TUNNEL_ID<span class="op">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View real-time logs</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> journalctl <span class="at">-u</span> cloudflared <span class="at">-f</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test connectivity</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">cloudflared</span> tunnel cleanup <span class="op">&lt;</span>TUNNEL_ID<span class="op">&gt;</span></span></code></pre></div>
<h3 id="monitor-cloudflare-dashboard">Surveiller le tableau de bord Cloudflare</h3>
<ol type="1">
<li>Zero Trust → Access → Tunnels</li>
<li>Vérifiez que le tunnel affiche le statut <strong>« Healthy »</strong> (Fonctionnel)</li>
<li>Consultez les <strong>Metrics</strong> (Métriques) pour les statistiques de trafic</li>
</ol>
<h2 id="security-considerations">Considérations de sécurité</h2>
<h3 id="enable-cloudflare-access-policies">1. Activer les politiques Cloudflare Access
</h3>
<p>Ajouter une couche d'authentification :</p>
<ol type="1">
<li><strong>Zero Trust</strong> → <strong>Access</strong> →
<strong>Applications</strong></li>
<li>Créer une application : <code>proxmox.olyhome.site</code></li>
<li>Ajouter une politique :
<ul>
<li>Règle : Email</li>
<li>Valeur : your-email@domain.com</li>
</ul></li>
<li>Nécessite désormais une connexion avant d'accéder à Proxmox</li>
</ol>
<h3 id="restrict-access-by-location">2. Restreindre l'accès par localisation</h3>
<pre><code>Policy Rules:
├── Include: Country is Morocco (or your country)
├── Exclude: Known VPN IP ranges
└── Require: Email verification</code></pre>
<h3 id="enable-audit-logs">3. Activer les journaux d'audit (Audit Logs)</h3>
<p>Suivre toutes les tentatives d'accès : - Zero Trust → Logs → Access -
Examiner les tentatives de connexion - Surveiller toute activité suspecte</p>
<h3 id="use-strong-proxmox-authentication">4. Utiliser une authentification Proxmox forte</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable 2FA in Proxmox</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Datacenter → Permissions → Users</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit user → Add TFA</span></span></code></pre></div>
<h2 id="performance-optimization">Optimisation des performances</h2>
<h3 id="reduce-latency">Réduire la latence</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In config.yml, add:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">originRequest</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">noTLSVerify</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">connectTimeout</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">httpHostHeader</span><span class="kw">:</span><span class="at"> proxmox.olyhome.site</span></span></code></pre></div>
<h3 id="enable-http2">Activer HTTP/2</h3>
<p>Cloudflare utilise automatiquement HTTP/2 entre le client et la périphérie,
ce qui améliore les performances.</p>
<h2 id="monitoring-and-maintenance">Surveillance et maintenance</h2>
<h3 id="regular-health-checks">Vérifications de l'état régulières</h3>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create monitoring script</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check-tunnel.sh</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">systemctl</span> is-active <span class="at">--quiet</span> cloudflared<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;✅ Tunnel is running&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;❌ Tunnel is down, restarting...&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">systemctl</span> restart cloudflared</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to crontab</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">crontab</span> <span class="at">-e</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># */5 * * * * /root/check-tunnel.sh</span></span></code></pre></div>
<h3 id="backup-configuration">Sauvegarde de la configuration</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backup tunnel config</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tar czf cloudflared-backup-<span class="va">$(</span><span class="fu">date</span> +%Y%m%d<span class="va">)</span>.tar.gz <span class="dt">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    /etc/cloudflared/</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Store offsite (Dropbox, Google Drive, etc.)</span></span></code></pre></div>
<h2 id="alternative-twingate-for-zero-trust-access">Alternative :
Twingate pour l'accès Zero Trust</h2>
<p>Pour une sécurité encore meilleure, envisagez <strong>Twingate</strong> :</p>
<pre><code>Advantages over Cloudflare Tunnel:
├── True zero-trust architecture
├── Per-application access control
├── No public DNS records needed
├── Client-side encryption
└── Better for multiple services</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Cloudflare Tunnel offre un accès à distance sécurisé et sans configuration à
Proxmox sans exposer les ports. La configuration nécessite un effort initial
mais aboutit à une solution robuste et prête pour la production.</p>
<p><strong>Résultats finaux :</strong> - ✅ Accès sécurisé à
<code>https://proxmox.olyhome.site</code> - ✅ Aucun port exposé sur le pare-feu - ✅ Certificats SSL gratuits - ✅ Redémarrage automatique du tunnel au démarrage - ✅ Protection DDoS incluse</p>
<p><strong>Prochaines étapes :</strong> - Ajouter plus de services au tunnel (N8N, bases de données, etc.) - Implémenter Cloudflare Access pour l'authentification - Mettre en place la surveillance et les alertes - Documenter les procédures de reprise après sinistre</p>
<p><em>Rapport généré: 2025-10-27 14:35</em></p>
                </div>

                <div class="article-navigation">
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>OLYAHYAI</h3>
                    <p>Pentester en formation | Passionné de cybersécurité</p>
                </div>

                <div class="footer-links">
                    <h4>Liens rapides</h4>
                    <ul>
                        <li><a href="/index.html#home">Accueil</a></li>
                        <li><a href="/index.html#about">À propos</a></li>
                        <li><a href="/index.html#projects">Projets</a></li>
                        <li><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-social">
                    <h4>Connecter</h4>
                    <div class="social-links">
                        <a href="https://github.com/OLYAHYAI" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://ma.linkedin.com/in/lyahyai-omar" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="mailto:contact@olyahyai.com">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 OLYAHYAI. Tous droits réservés.</p>
                <p>Construit avec <i class="fas fa-heart"></i> et <i class="fas fa-terminal"></i></p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Retour en haut de page">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/animations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>