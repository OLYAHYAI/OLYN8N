<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Segment your homelab for bulletproof security. Use VLANs and smart architecture to isolate servers, IoT, and cameras, turning flat networks into secure zones.">
    <meta name="keywords" content="homelab">
    <meta name="author" content="OLYAHYAI">

    <title>Building Secure Homelab Network Vlans Architecture | Omar LYAHYAI Technical Blog</title>

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/blog.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="dark-theme">
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="container">
                <div class="nav-brand">
                    <a href="/index.html" class="logo">
                        <i class="fas fa-terminal"></i>
                        <span>OLYAHYAI</span>
                    </a>
                </div>

                <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="/index.html#home" class="nav-link">Home</a></li>
                    <li><a href="/index.html#about" class="nav-link">About</a></li>
                    <li><a href="/index.html#projects" class="nav-link">Projects</a></li>
                    <li><a href="/index.html#skills" class="nav-link">Skills</a></li>
                    <li><a href="/blog/index.html" class="nav-link active">Blog</a></li>
                    <li><a href="/index.html#contact" class="nav-link">Contact</a></li>
                </ul>

                <div class="nav-actions">
                    <a href="/fr/network_security/building-secure-homelab-network-vlans-architecture.html" class="lang-toggle" aria-label="Change language">
                        <span class="lang-current">FR</span>
                        <i class="fas fa-globe"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="article-header" role="region" aria-label="Article header">
            <div class="container">
                <div class="article-breadcrumb">
                    <nav class="breadcrumb" aria-label="Breadcrumb">
                        <a href="/index.html">Home</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/index.html">Blog</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <a href="/blog/network_security.html">Network Security</a>
                        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                        <span>Building Secure Homelab Network Vlans Architecture</span>
                    </nav>
                </div>

                <h1 class="article-title">Building Secure Homelab Network Vlans Architecture</h1>

                <div class="article-meta">
                    <div class="article-meta-item">
                        <i class="far fa-calendar"></i>
                        <span>2025-11-19</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="far fa-clock"></i>
                        <span>5 min min read</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-folder"></i>
                        <span>Network Security</span>
                    </div>
                    <div class="article-meta-item">
                        <i class="fas fa-tags"></i>
                        <span>homelab</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="article-content" role="region" aria-label="Article content">
            <div class="container">
                <div class="article-body">
                    <!-- 
TEMPLATE - Press Alt+E to apply

UPDATE THESE FIELDS:
- title: "Your Title" (KEEP QUOTES)
- date: "YYYY-MM-DD" (KEEP QUOTES)
- category: infrastructure/network_security/automation_ai/reference
- language: auto (let workflow detect) | en (force English) | fr (force French)
- tags: single-keyword-only (NO COMMAS! Use one word or hyphenated)
- description: "Short summary" (KEEP QUOTES)

CRITICAL RULES:
✅ DO: Keep quotes around title, date, description
✅ DO: Use "auto" for language to let workflow detect from content
✅ DO: Use single word for tags (homelab, pfsense, proxmox)
❌ DON'T: Use commas in tags (breaks YAML!)
❌ DON'T: Remove quotes from title/date/description

The workflow will:
- Detect language automatically from your content
- Generate English + French versions
- Create full HTML with navigation
- Preserve images and links
-->
<h1
id="building-a-secure-homelab-network-with-vlans-and-smart-architecture">Building
a Secure Homelab Network with VLANs and Smart Architecture</h1>
<h2
id="the-journey-begins-why-my-homelab-needed-a-security-overhaul">The
Journey Begins: Why My Homelab Needed a Security Overhaul</h2>
<p>When I first set up my homelab, like most enthusiasts, I plugged
everything into the same network switch and called it a day. My
Kubernetes cluster, smart home devices, media servers, and security
cameras all lived on the same subnet—a ticking time bomb of security
vulnerabilities. One compromised IoT device could have meant instant
access to my entire network. That’s when I realized I needed to
architect something better.</p>
<p>This is the story of how I transformed my chaotic home network into a
segmented, secure infrastructure using VLANs (Virtual Local Area
Networks) and thoughtful architecture—all while learning what it really
means to design for security at home.</p>
<hr />
<h2
id="part-1-understanding-the-problem---why-network-segmentation-matters">Part
1: Understanding the Problem - Why Network Segmentation Matters</h2>
<h3 id="the-flat-network-nightmare">The Flat Network Nightmare</h3>
<p>Imagine your entire house is one big hallway. The front door security
system, your personal computer, the kitchen smart fridge, and your
server with all your photos and documents are all standing in the same
hallway with no walls between them.</p>
<p>If someone (or something) compromises any device on your network,
they have a clear path to everything else. This is exactly what happens
with a flat, unsegmented network.</p>
<p><strong>The real risks:</strong> - <strong>Compromised IoT
devices</strong> (like a hacked smart bulb) can scan and exploit other
devices - <strong>Man-in-the-Middle (MITM) attacks</strong> happen when
someone intercepts traffic between devices - <strong>Lateral
movement</strong> - An attacker gains access to one device, then pivots
to sensitive systems - <strong>Data exfiltration</strong> - Sensitive
files are stolen by malware or attackers without your knowledge</p>
<h3 id="the-vlan-solution">The VLAN Solution</h3>
<p>VLANs are like building walls in that hallway. They create separate
networks that appear as distinct subnets, even though they share the
same physical network infrastructure. Think of it like this:</p>
<ul>
<li><strong>VLAN 10 (Management)</strong>: Your network infrastructure,
cameras, and admin tools - highly restricted</li>
<li><strong>VLAN 20 (Servers)</strong>: Production services like
Kubernetes, databases, file storage</li>
<li><strong>VLAN 30 (IoT/Smart Home)</strong>: Smart bulbs, thermostats,
and cameras - untrusted by default</li>
<li><strong>VLAN 40 (Guests)</strong>: Visitors’ devices - completely
isolated</li>
<li><strong>VLAN 50 (Work/Personal)</strong>: Your PCs, laptops, and
trusted devices</li>
</ul>
<p>With VLANs, even if someone compromises your IoT network, they can’t
directly access your server infrastructure. They hit a firewall rule
instead of an open connection.</p>
<hr />
<h2
id="part-2-my-network-architecture---a-story-of-thoughtful-design">Part
2: My Network Architecture - A Story of Thoughtful Design</h2>
<h3 id="the-hardware-foundation">The Hardware Foundation</h3>
<pre><code>Internet
   ↓
[pfSense Firewall/Router]
   ↓
[Managed Switch with VLAN Support]
   ↓
├─ VLAN 10 (Management) → Network monitoring, SSH access points
├─ VLAN 20 (Servers) → Kubernetes, databases, services
├─ VLAN 30 (IoT) → Smart home devices, restricted access
├─ VLAN 40 (Guests) → Isolated visitor network
└─ VLAN 50 (Trusted) → Personal computers, laptops</code></pre>
<p><strong>Key Component: The Managed Switch</strong></p>
<p>The switch is your segmentation point. It understands VLANs and can
tag traffic appropriately. I’m using a switch that supports: - VLAN
tagging (802.1Q) - Access and trunk ports - Basic QoS for traffic
prioritization - Managed configuration (not just plug-and-play)</p>
<p><strong>Why pfSense as the Firewall:</strong></p>
<p>I chose pfSense because: 1. <strong>VLAN-aware</strong> - It
understands VLAN tagging and can route between them 2. <strong>Firewall
rules by VLAN</strong> - I can create granular rules like “IoT can only
reach DNS and specific servers” 3. <strong>Open source</strong> - Full
transparency into security rules 4. <strong>Community-driven</strong> -
Constantly updated with security patches</p>
<hr />
<h2 id="part-3-setting-up-vlans---the-implementation">Part 3: Setting Up
VLANs - The Implementation</h2>
<h3 id="step-1-configure-the-switch">Step 1: Configure the Switch</h3>
<p>On your managed switch, you need to:</p>
<ol type="1">
<li><p><strong>Create VLAN IDs</strong> (untagged):</p>
<pre><code>VLAN 10 - Management (10.0.10.0/24)
VLAN 20 - Servers (10.0.20.0/24)
VLAN 30 - IoT (10.0.30.0/24)
VLAN 40 - Guests (10.0.40.0/24)
VLAN 50 - Trusted (10.0.50.0/24)</code></pre></li>
<li><p><strong>Configure ports as access or trunk:</strong></p>
<ul>
<li><strong>Access ports</strong> (connect to regular devices):
<ul>
<li>Port 1 → VLAN 30 (IoT device)</li>
<li>Port 2 → VLAN 50 (Your laptop)</li>
<li>Port 3 → VLAN 40 (Guest WiFi AP)</li>
</ul></li>
<li><strong>Trunk ports</strong> (connect to other switches/firewall):
<ul>
<li>Port 24 → Connects to pfSense (carries all VLANs)</li>
</ul></li>
</ul></li>
<li><p><strong>Set VLAN 1 as native</strong> (untagged traffic defaults
to VLAN 1)</p></li>
</ol>
<h3 id="step-2-configure-pfsense-for-vlan-routing">Step 2: Configure
pfSense for VLAN Routing</h3>
<p>In pfSense, create virtual interfaces for each VLAN:</p>
<pre><code>Interfaces → Assignments
- VLAN 10 (em0.10) → OPT1 (Management)
- VLAN 20 (em0.20) → OPT2 (Servers)
- VLAN 30 (em0.30) → OPT3 (IoT)
- VLAN 40 (em0.40) → OPT4 (Guests)
- VLAN 50 (em0.50) → OPT5 (Trusted)</code></pre>
<p>Assign IP addresses to each interface:</p>
<pre><code>Management:  10.0.10.1/24
Servers:     10.0.20.1/24
IoT:         10.0.30.1/24
Guests:      10.0.40.1/24
Trusted:     10.0.50.1/24</code></pre>
<h3 id="step-3-create-firewall-rules">Step 3: Create Firewall Rules</h3>
<p>Now for the magic—the rules that actually enforce security:</p>
<p><strong>IoT VLAN Rules</strong> (most restrictive):</p>
<pre><code>- Allow: IoT → DNS (53)
- Allow: IoT → NTP (123)
- Allow: IoT → Specific server (e.g., Home Assistant on VLAN 50)
- Deny: IoT → Any other network (default)
- Deny: IoT → Internet (no direct outbound)</code></pre>
<p><strong>Server VLAN Rules</strong>:</p>
<pre><code>- Allow: Servers ↔ Servers (internal communication)
- Allow: Servers → Internet (managed outbound)
- Allow: Trusted → Servers (selective access)
- Deny: IoT → Servers (complete isolation)</code></pre>
<p><strong>Trusted VLAN Rules</strong>:</p>
<pre><code>- Allow: Trusted → All VLANs (user devices need flexibility)
- Allow: Trusted → Internet
- Deny: Untrusted → Trusted</code></pre>
<p><strong>Guest VLAN Rules</strong>:</p>
<pre><code>- Allow: Guests → Internet only
- Allow: Guests → Public services (e.g., Plex, HomeAssistant)
- Deny: Guests → Any internal network</code></pre>
<hr />
<h2 id="part-4-the-security-benefits-ive-realized">Part 4: The Security
Benefits I’ve Realized</h2>
<h3 id="real-world-protection">Real-World Protection</h3>
<p>After implementing this architecture, here’s what changed:</p>
<ol type="1">
<li><p><strong>Attack Surface Reduction</strong>: Even if my security
camera gets compromised, it’s trapped in VLAN 30. It can’t reach my
server data, my work laptop, or my personal files.</p></li>
<li><p><strong>Compliance-Ready</strong>: If I ever need to pass
security audits, I have documented network segmentation.</p></li>
<li><p><strong>Service Isolation</strong>: My Kubernetes cluster
failures don’t affect IoT devices. A misconfigured app in VLAN 20
doesn’t break smart home automation in VLAN 30.</p></li>
<li><p><strong>Visibility</strong>: pfSense logs show me exactly who’s
talking to whom. A suspicious IoT device trying to reach internal
networks gets logged immediately.</p></li>
<li><p><strong>Guest Confidence</strong>: I can give guests WiFi (VLAN
40) without worrying they’ll stumble across my server data.</p></li>
</ol>
<hr />
<h2 id="part-5-advanced-techniques-and-lessons-learned">Part 5: Advanced
Techniques and Lessons Learned</h2>
<h3 id="vlan-hopping---a-real-threat-i-defended-against">VLAN Hopping -
A Real Threat I Defended Against</h3>
<p>When I first set up VLANs, I thought the firewall rules alone would
protect me. Wrong. An attacker could potentially “hop” between VLANs
using: - <strong>802.1Q double-tagging</strong>: Sending specially
crafted packets - <strong>Switch exploitation</strong>: Misconfigured
switch ACLs</p>
<p><strong>My defense:</strong> 1. Kept all switch firmware updated 2.
Disabled unused ports (set to access mode on a dead VLAN) 3. Protected
management access with strong credentials 4. Implemented DHCP snooping
and ARP inspection 5. Regular security audits of VLAN configurations</p>
<h3 id="wifi-integration---bridging-physical-and-wireless">WiFi
Integration - Bridging Physical and Wireless</h3>
<p>My WiFi APs are in VLAN 40 (Guests), VLAN 50 (Personal), and VLAN 30
(IoT). Each SSID is configured to tag traffic appropriately:</p>
<pre><code>SSID &quot;HomeNetwork&quot; → Tagged VLAN 50 (WPA3, strong password)
SSID &quot;IoT-Devices&quot; → Tagged VLAN 30 (WPA2, unique password)
SSID &quot;Guests&quot; → Tagged VLAN 40 (WPA2, shared password)</code></pre>
<p>The AP doesn’t need to understand VLANs deeply—just needs to tag
traffic with the right VLAN ID based on which SSID the device connects
to.</p>
<h3 id="monitoring-and-logging">Monitoring and Logging</h3>
<p>I set up pfSense state tables monitoring:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitor active connections</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pfctl</span> <span class="at">-s</span> states</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View firewall logs</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-f</span> /var/log/filter.log</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count traffic between VLANs</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">tcpdump</span> <span class="at">-i</span> em0 vlan 10 and vlan 30</span></code></pre></div>
<p>Suspicious patterns I watch for: - IoT devices initiating connections
to servers (should only respond to requests) - Large data transfers from
trusted networks - Connections to unusual ports - Any traffic from
guests to internal networks</p>
<hr />
<h2 id="part-6-cost-and-practical-considerations">Part 6: Cost and
Practical Considerations</h2>
<h3 id="hardware-requirements">Hardware Requirements</h3>
<p><strong>What you’ll need:</strong> - <strong>Managed switch</strong>
with VLAN support: $200-600 USD depending on port count -
<strong>pfSense-capable hardware</strong>: $150-400 (or repurpose old
PC) - <strong>WiFi APs with VLAN tagging</strong>: $100-300 per AP
(UniFi, TP-Link Omada)</p>
<p><strong>Optional but recommended:</strong> - Network monitoring tool
(Zabbix, Prometheus) - Dedicated logging server - Intrusion detection
system (Suricata)</p>
<h3 id="complexity-vs.-security-trade-off">Complexity vs. Security
Trade-off</h3>
<p>VLANs add some complexity, but it’s manageable: - Initial setup takes
4-8 hours - Monthly management: 30 minutes - Troubleshooting: VLANs are
sometimes blamed for issues that are actually elsewhere (I’ve been
there)</p>
<hr />
<h2 id="part-7-lessons-i-wish-id-known-earlier">Part 7: Lessons I Wish
I’d Known Earlier</h2>
<ol type="1">
<li><p><strong>Document everything</strong> - Keep a diagram of VLAN
IDs, IP ranges, and firewall rules. Future you will thank you.</p></li>
<li><p><strong>Start simple, expand gradually</strong> - Don’t create 20
VLANs on day one. Start with 3-4 and add as needed.</p></li>
<li><p><strong>Test rules before enforcing</strong> - Set up logging
first, then gradually move from “Allow all” to “Deny all
except…”</p></li>
<li><p><strong>VLAN 1 is special</strong> - Keep it unused or used only
for management. Don’t put production devices there.</p></li>
<li><p><strong>Management VLAN access is critical</strong> - If you lock
yourself out of your management VLAN, you’ll need physical access to
recover. Learned this the hard way.</p></li>
<li><p><strong>Not all devices support VLANs well</strong> - Some older
IoT devices don’t understand VLAN tagging. Keep a fallback unsegmented
network for legacy devices if needed.</p></li>
</ol>
<hr />
<h2 id="conclusion-from-chaos-to-architecture">Conclusion: From Chaos to
Architecture</h2>
<p>What started as a flat network with everything connected to one
switch transformed into a thoughtfully segmented infrastructure. Every
device now lives in its own neighborhood with clear rules about who can
visit whom.</p>
<p>The security improvement is significant. The operational complexity?
Actually minimal once you understand the concepts.</p>
<p>If you’re building a homelab today, I highly recommend starting with
VLAN segmentation from day one. It’s like building with walls from the
start instead of trying to add them later.</p>
<p>This architecture isn’t just about security—it’s about having
confidence in your network. When you understand the traffic flow and
have explicit rules for each segment, you can relax knowing that a
compromised IoT device isn’t a threat to your entire infrastructure.</p>
<hr />
<h2 id="quick-reference-my-final-configuration">Quick Reference: My
Final Configuration</h2>
<pre><code>┌─────────────────────────────────────────────────────────┐
│                  HOMELAB NETWORK DESIGN                 │
├─────────────────────────────────────────────────────────┤
│ VLAN 10: Management    (10.0.10.0/24) - CRITICAL        │
│ VLAN 20: Servers       (10.0.20.0/24) - CORE SERVICES   │
│ VLAN 30: IoT/Smart     (10.0.30.0/24) - UNTRUSTED       │
│ VLAN 40: Guests        (10.0.40.0/24) - ISOLATED        │
│ VLAN 50: Trusted/Work  (10.0.50.0/24) - PERSONAL        │
└─────────────────────────────────────────────────────────┘

Traffic Rules (Default: DENY)
├─ Trusted ↔ All (flexible access)
├─ Servers ↔ Servers + controlled access
├─ Management → All (admin access)
├─ IoT → DNS, NTP, specific services only
└─ Guests → Internet only</code></pre>
<p>Build smart. Segment intentionally. Sleep well knowing your network
is secure.</p>
                </div>

                <div class="article-navigation">
                </div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>OLYAHYAI</h3>
                    <p>Pentester in Training | Cybersecurity Enthusiast</p>
                </div>

                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/index.html#home">Home</a></li>
                        <li><a href="/index.html#about">About</a></li>
                        <li><a href="/index.html#projects">Projects</a></li>
                        <li><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>

                <div class="footer-social">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="https://github.com/OLYAHYAI" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://ma.linkedin.com/in/lyahyai-omar" target="_blank" rel="noopener">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="mailto:contact@olyahyai.com">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 OLYAHYAI. All rights reserved.</p>
                <p>Built with <i class="fas fa-heart"></i> and <i class="fas fa-terminal"></i></p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/animations.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>